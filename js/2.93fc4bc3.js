(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"404a":function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));a("caad");var o=a("4204");a("bd4c");class i{static getInstance(){return new i}get(t,e){const a=t&&t.includes(" ")?t:`${t} 00:00:00`,i=e&&e.includes(" ")?e:`${e} 23:59:59`;return console.log("ventasDAO.get - Fechas recibidas:",t,e),console.log("ventasDAO.get - Fechas completas:",a,i),o["a"].ventas.where("create_at").between(a,i,!0,!0).toArray().then((t=>(console.log("ventasDAO.get - Resultados encontrados:",t.length),t)))}save(t){return o["a"].ventas.add(t)}getOne(t){return o["a"].ventas.get({id:t})}delete(t){return o["a"].ventas.delete(t)}getNombre(t){return o["a"].ventas.get({nombre:t})}}},4204:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var o=a("4dec"),i=a("c056"),r=a("dc98"),s=a("abab");const n=new o["a"]("BODEGUITA");n.version(1).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at",ventas:"++id, total, *productos, create_at, update_at"}),n.version(2).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad"}),n.version(3).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia"}),n.version(4).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo"}),n.version(5).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva"}),n.version(6).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),n.version(7).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),n.version(8).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value"}),n.version(9).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),n.version(10).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),n.version(11).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado, monto_exento, monto_base, monto_iva, tasa_iva, monto_igtf, tasa_dolar, monto_dolar",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),n.open().catch((function(t){console.error("Fallo al abrir la base de datos: "+(t.stack||t))})),n.valores_dolar.mapToClass(i["a"]),n.movimientos.mapToClass(r["a"]),n.clientes.mapToClass(s["a"])},"45e8":function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));var o=a("4204");a("bd4c");class i{static getInstance(){return new i}get(){return o["a"].productos.toArray()}save(t){return o["a"].productos.add(t)}update(t,e){return o["a"].productos.update(t,e)}getOne(t){return o["a"].productos.get({id:t})}delete(t){return o["a"].productos.delete(t)}getNombre(t){return o["a"].productos.get({nombre:t})}}},"52c0":function(t,e,a){"use strict";a("b3d7")},"8b24":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("q-page",{staticClass:"q-pa-md q-pb-xl bg-grey-1"},[e("q-card",{staticClass:"rounded-card q-mb-md shadow-1 bg-white"},[e("q-card-section",[e("div",{staticClass:"row q-col-gutter-sm"},[e("div",{staticClass:"col-12 col-sm-8"},[e("q-select",{staticClass:"rounded-borders",attrs:{filled:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",options:t.options,label:"Buscar Producto",color:"primary",behavior:"menu"},on:{filter:t.filterFn},scopedSlots:t._u([{key:"no-option",fn:function(){return[e("q-item",[e("q-item-section",{staticClass:"text-grey"},[t._v("Sin resultados")])],1)]},proxy:!0},{key:"prepend",fn:function(){return[e("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.producto,callback:function(e){t.producto=e},expression:"producto"}})],1),e("div",{staticClass:"col-6 col-sm-2"},[e("q-input",{staticClass:"rounded-borders",attrs:{filled:"",type:"number",label:"Cant.",color:"primary",min:"1"},model:{value:t.cantidad,callback:function(e){t.cantidad=t._n(e)},expression:"cantidad"}})],1),e("div",{staticClass:"col-6 col-sm-2"},[e("q-btn",{staticClass:"full-width full-height shadow-0 rounded-borders",attrs:{color:"primary",icon:"add_shopping_cart",label:"Agregar"},on:{click:t.agregarListaCompra}})],1)])])],1),t.lista_compras.length>0?e("div",{staticClass:"q-mb-xl",staticStyle:{"padding-bottom":"80px"}},[e("div",{staticClass:"row items-center justify-between q-mb-sm"},[e("div",{staticClass:"text-h6 text-grey-8"},[t._v("Carrito ("+t._s(t.lista_compras.length)+")")]),e("q-btn",{attrs:{flat:"",dense:"",color:"negative",label:"Limpiar",size:"sm"},on:{click:function(e){t.lista_compras=[],t.total=0}}})],1),e("div",{staticClass:"row q-col-gutter-sm"},t._l(t.lista_compras,(function(a,o){return e("div",{key:o,staticClass:"col-12 col-md-6"},[e("q-card",{staticClass:"rounded-card shadow-1"},[e("q-item",{staticClass:"q-py-md"},[e("q-item-section",{attrs:{avatar:""}},[e("q-avatar",{attrs:{color:"indigo-1","text-color":"primary",icon:"inventory_2"}})],1),e("q-item-section",[e("q-item-label",{staticClass:"text-weight-bold text-dark"},[t._v(t._s(a.producto))]),e("q-item-label",{attrs:{caption:""}},[t._v("\n                Cant: "+t._s(a.cantidad)+" | Stock: "+t._s(a.existencia)+"\n              ")])],1),e("q-item-section",{staticClass:"text-right",attrs:{side:""}},[e("div",{staticClass:"text-weight-bold text-primary"},[t._v("\n                Bs "+t._s(t.formatMoney(a.valor_bs))+"\n              ")]),t.valor_dolar?e("div",{staticClass:"text-caption text-grey"},[t._v("\n                $ "+t._s(t.formatMoneyUSD(a.valor_bs/t.valor_dolar))+"\n              ")]):t._e()]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",round:"",color:"negative",icon:"delete_outline"},on:{click:function(e){return t.eliminarProductoLista(o)}}})],1)],1)],1)],1)})),0)]):e("div",{staticClass:"text-center q-mt-xl text-grey-5"},[e("q-icon",{staticClass:"q-mb-md",attrs:{name:"shopping_cart",size:"64px"}}),e("div",{staticClass:"text-h6"},[t._v("Carrito vacÃ­o")]),e("div",{staticClass:"text-caption"},[t._v("Agrega productos para comenzar")])],1),t.lista_compras.length>0?e("q-page-sticky",{staticClass:"lt-md",staticStyle:{"z-index":"2000"},attrs:{position:"bottom",offset:[0,0],expand:""}},[e("div",{staticClass:"bg-white q-pa-md shadow-up-2 row items-center justify-between full-width",staticStyle:{"border-top-left-radius":"16px","border-top-right-radius":"16px"}},[e("div",[e("div",{staticClass:"text-caption text-grey"},[t._v("Total a Pagar")]),e("div",{staticClass:"text-h6 text-primary text-weight-bold"},[t._v("\n          Bs "+t._s(t.formatMoney(t.total))+"\n        ")]),t.valor_dolar?e("div",{staticClass:"text-subtitle2 text-grey-7"},[t._v("\n          $ "+t._s(t.formatMoneyUSD(t.total/t.valor_dolar))+"\n        ")]):t._e()]),e("q-btn",{staticClass:"q-px-lg",attrs:{color:"primary",label:"Pagar",icon:"payments",rounded:"",unelevated:""},on:{click:function(e){t.confirmPaymentDialog=!0}}})],1)]):t._e(),t.lista_compras.length>0?e("q-page-sticky",{staticClass:"gt-sm",staticStyle:{"z-index":"2000"},attrs:{position:"bottom",offset:[0,0],expand:""}},[e("div",{staticClass:"bg-primary text-white shadow-up-2 row items-center justify-between full-width q-px-xl q-py-md"},[e("div",{staticClass:"row items-center q-gutter-x-md"},[e("div",{staticClass:"text-subtitle1 text-indigo-2"},[t._v("Total a Pagar:")]),e("div",{staticClass:"text-h4 text-indigo-2 text-weight-bold"},[t._v("Bs "+t._s(t.formatMoney(t.total)))]),t.valor_dolar?e("div",{staticClass:"text-h5 text-indigo-2"},[t._v("\n          $ "+t._s(t.formatMoneyUSD(t.total/t.valor_dolar))+"\n        ")]):t._e()]),e("q-btn",{staticClass:"q-px-xl",attrs:{color:"white","text-color":"primary",label:"Pagar",icon:"payments",rounded:"",unelevated:"",size:"lg"},on:{click:function(e){t.confirmPaymentDialog=!0}}})],1)]):t._e(),e("q-dialog",{model:{value:t.confirmPaymentDialog,callback:function(e){t.confirmPaymentDialog=e},expression:"confirmPaymentDialog"}},[e("q-card",{staticStyle:{"min-width":"350px","border-radius":"16px"}},[e("q-card-section",{staticClass:"row items-center q-pb-none"},[e("div",{staticClass:"text-h6 text-primary"},[t._v("Confirmar Pago")]),e("q-space"),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),e("q-card-section",[e("div",{staticClass:"text-subtitle1 q-mb-md"},[t._v("\n          Â¿Deseas procesar la venta por "),e("span",{staticClass:"text-weight-bold"},[t._v("Bs "+t._s(t.formatMoney(t.total)))]),t._v("?\n        ")]),e("q-select",{staticClass:"q-mb-sm",attrs:{filled:"",options:t.paymentOptions,label:"MÃ©todo de Pago",rules:[t=>!!t||"Requerido"]},scopedSlots:t._u([{key:"prepend",fn:function(){return[e("q-icon",{attrs:{name:"payments"}})]},proxy:!0}]),model:{value:t.form.metodo_pago,callback:function(e){t.$set(t.form,"metodo_pago",e)},expression:"form.metodo_pago"}}),t.valor_dolar?e("div",{staticClass:"text-caption text-grey"},[t._v("\n          Equivalente a $ "+t._s(t.formatMoneyUSD(t.total/t.valor_dolar))+"\n        ")]):t._e()],1),e("q-card-actions",{staticClass:"q-pt-none q-pb-md q-px-md",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancelar",color:"grey"}}),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{unelevated:"",label:"Confirmar",color:"primary"},on:{click:t.confirmAndSave}})],1)],1)],1),e("q-dialog",{attrs:{persistent:""},model:{value:t.clienteDialog,callback:function(e){t.clienteDialog=e},expression:"clienteDialog"}},[e("q-card",{staticStyle:{"min-width":"350px","border-radius":"16px"}},[e("q-card-section",{staticClass:"row items-center"},[e("div",{staticClass:"text-h6 text-primary"},[t._v("Cliente para Fiado")]),e("q-space"),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),e("q-card-section",[e("div",{staticClass:"row q-col-gutter-sm items-end"},[e("div",{staticClass:"col"},[e("q-input",{attrs:{filled:"",label:"CÃ©dula",autofocus:""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.buscarCliente.apply(null,arguments)}},model:{value:t.cedulaSearch,callback:function(e){t.cedulaSearch=e},expression:"cedulaSearch"}})],1),e("div",{staticClass:"col-auto"},[e("q-btn",{staticClass:"q-mb-sm",attrs:{icon:"search",color:"primary",round:"",unelevated:""},on:{click:t.buscarCliente}})],1)])]),!1===t.clienteFound?e("q-card-section",[e("div",{staticClass:"text-subtitle2 text-orange q-mb-sm"},[t._v("Cliente no encontrado. Registrar nuevo:")]),e("q-input",{staticClass:"q-mb-sm",attrs:{filled:"",label:"Nombre y Apellido"},model:{value:t.clienteForm.nombre,callback:function(e){t.$set(t.clienteForm,"nombre",e)},expression:"clienteForm.nombre"}}),e("q-input",{staticClass:"q-mb-sm",attrs:{filled:"",label:"TelÃ©fono"},model:{value:t.clienteForm.telefono,callback:function(e){t.$set(t.clienteForm,"telefono",e)},expression:"clienteForm.telefono"}})],1):t._e(),t.clienteFound?e("q-card-section",[e("div",{staticClass:"text-subtitle1 text-indigo-10"},[e("strong",[t._v("Cliente:")]),t._v(" "+t._s(t.clienteFound.nombre)+" "),e("br"),e("small",[t._v(t._s(t.clienteFound.telefono))])])]):t._e(),e("q-card-actions",{attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancelar",color:"grey"}}),!1===t.clienteFound?e("q-btn",{attrs:{label:"Registrar y Procesar",color:"primary"},on:{click:t.registrarYContinuar}}):t._e(),t.clienteFound?e("q-btn",{attrs:{label:"Confirmar Fiado",color:"primary"},on:{click:t.confirmarFiadoExistente}}):t._e()],1)],1)],1)],1)},i=[],r=(a("caad"),a("ddb0"),a("bd4c")),s=a("45e8"),n=a("e633"),c=a("404a"),l=a("ed9b1"),d=a("4204"),u=a("9a27"),m=a("dc98");a("d9e2"),a("5319"),a("2b3d"),a("9861");function p(){return new Worker(a.p+"js/recommendation.worker.c22aec0d.worker.js")}console.log("!!! RECOMMENDATION SERVICE FILE LOADED !!!");class h{constructor(){this.worker=null,this.pendingRequests=new Map,this.idCounter=0,this.ready=!1}_generateId(){return++this.idCounter}async init(){if(!this.ready)try{console.log("[RecommendationService] Initializing Worker..."),this.worker=new p,this.worker.onmessage=t=>{console.log("[RecommendationService] Message from worker:",t.data);const{id:e,type:a,payload:o}=t.data;if("ERROR"!==a)if(this.pendingRequests.has(e)){const{resolve:t}=this.pendingRequests.get(e);t(o),this.pendingRequests.delete(e)}else console.warn("[RecommendationService] Received message with unknown or expired ID:",e);else if(console.error("[RecommendationService] Worker Error:",o),this.pendingRequests.has(e)){const{reject:t}=this.pendingRequests.get(e);t(new Error(o)),this.pendingRequests.delete(e)}},this.worker.onerror=t=>{console.error("[RecommendationService] Worker Script Error:",t.message,"at",t.filename,"line",t.lineno)};const e=window.location.origin+window.location.pathname.replace(/index\.html$/,""),a=new URL("bodeguita_recommendations_bg.wasm",document.baseURI||e).href;console.log("[RecommendationService] Configured WASM URL:",a);const o=t=>new Promise(((e,a)=>{const o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=()=>{200===o.status||0===o.status&&o.response?e(o.response):a(new Error(`Failed to load WASM via XHR. Status: ${o.status}`))},o.onerror=()=>a(new Error("Network error loading WASM via XHR")),o.send()}));try{const t=await o(a);console.log(`[RecommendationService] WASM loaded as ArrayBuffer: ${t.byteLength} bytes`),this.worker.postMessage({type:"INIT",payload:{wasmBytes:t}},[t])}catch(t){console.error("[RecommendationService] Failed to load WASM bytes, falling back to URL:",t),this.worker.postMessage({type:"INIT",payload:{wasmUrl:a}})}this.ready=!0,console.log("[RecommendationService] Worker initialized and ready.")}catch(e){console.error("[RecommendationService] Failed to initialize worker:",e)}}_send(t,e={}){return this.worker||this.init(),new Promise(((a,o)=>{const i=this._generateId();this.pendingRequests.set(i,{resolve:a,reject:o}),this.worker.postMessage({id:i,type:t,payload:e})}))}async train(){return this.ready||await this.init(),console.log("[RecommendationService] Requesting model training..."),this._send("TRAIN")}async getRecommendation(t,e=[]){return this.ready||await this.init(),this._send("RECOMMEND",{currentProductId:t,excludedIds:e})}}const _=new h;var g=a("dc92"),v=a("9751"),f=a("abab"),b={name:"PageIndex",data(){return{valor_dolar:null,lista_compras:[],form:new l["a"],total:0,cantidad:1,producto:null,options:[],stringOptions:[],recommendedProduct:null,confirmPaymentDialog:!1,paymentOptions:["Efectivo Bs","Efectivo $","Pago MÃ³vil","Punto de Venta","Zelle","Fiado"],clienteDialog:!1,clienteFound:null,clienteForm:new f["a"],cedulaSearch:"",tributos:{cobrar_iva:!1,cobrar_igtf:!1},montoIGTF:0,totalConIGTF:0}},computed:{hoyDate(){let t=Date.now();return r["b"].formatDate(t,"dddd D MMMM hh:mm A")},fechaCreacion(){let t=Date.now();return r["b"].formatDate(t,"YYYY/MM/DD HH:mm:ss")}},watch:{"form.metodo_pago"(t){["Efectivo $","Zelle"].includes(t)&&this.tributos.cobrar_igtf?this.calcularIGTF():(this.montoIGTF=0,this.totalConIGTF=this.total)}},mounted(){this.getProdutos(),this.getDolar(),this.loadConfig(),_.init()},methods:{async loadConfig(){const t=await g["a"].getInstance().get("tributos");t&&(this.tributos={...t})},formatMoney(t){return new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t||0)},formatMoneyUSD(t){return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t||0)},getProdutos(){s["a"].getInstance().get().then((t=>{t.forEach((t=>this.stringOptions.push(t.nombre)))}))},getDolar(){n["a"].getInstance().getUltimo().then((t=>{this.valor_dolar=t.valor_dolar}))},agregarListaCompra(){let t=this.producto;t?(this.$q.loading.show(),s["a"].getInstance().getNombre(t).then((t=>{this.$q.loading.hide();const e=Number(t.porcentaje_ganancia||0),a=Number(t.porcentaje_iva||0),o=Number(t.costo||0)*(1+e/100);let i=o,r=0;this.tributos.cobrar_iva&&a>0&&(r=o*(a/100),i=o+r);const s=Number(this.valor_dolar),n=Number(this.cantidad),c=this.lista_compras.filter((e=>e.id===t.id)).reduce(((t,e)=>t+e.cantidad),0);if(n+c>t.cantidad)return this.$q.loading.hide(),void this.$q.notify({type:"negative",message:`Stock insuficiente. Disponible: ${t.cantidad}. (En carrito: ${c})`});const l=Number(t.costo||0)*s*n,d=i*s,u=d*n,m=o*s*n,p=r*s*n;this.lista_compras.push({id:t.id,producto:t.nombre,valor_bs:u,valor_unitario_bs:d,costo_total_bs:l,costo_unitario_bs:Number(t.costo||0)*s,cantidad:n,valor_dolar:s,existencia:t.cantidad,es_exento:!this.tributos.cobrar_iva||0===a,tasa_iva:this.tributos.cobrar_iva?a:0,monto_base_bs:m,monto_iva_bs:p}),this.total=this.lista_compras.reduce(((t,e)=>t+e.valor_bs),0),this.totalConIGTF=this.total,this.producto=null,this.cantidad=1,this.checkRecommendation(t.id)}))):this.$q.notify({position:"top",type:"negative",message:"Debe agregar un producto a la lista"})},calcularIGTF(){this.tributos.cobrar_igtf&&(this.montoIGTF=.03*this.total,this.totalConIGTF=this.total+this.montoIGTF)},confirmAndSave(){if(this.form.metodo_pago)return"Fiado"===this.form.metodo_pago?(this.clienteDialog=!0,this.clienteFound=null,this.clienteForm=new f["a"],void(this.cedulaSearch="")):void this.save();this.$q.notify({type:"warning",message:"Seleccione un mÃ©todo de pago"})},async buscarCliente(){if(this.cedulaSearch){this.$q.loading.show();try{const t=await v["a"].getInstance().getByCedula(this.cedulaSearch);t?(this.clienteFound=t,this.clienteForm={...t}):(this.clienteFound=!1,this.clienteForm=new f["a"],this.clienteForm.cedula=this.cedulaSearch)}catch(t){console.error(t)}finally{this.$q.loading.hide()}}},async registrarYContinuar(){if(this.clienteForm.nombre&&this.clienteForm.telefono){this.$q.loading.show();try{let t;this.clienteFound&&this.clienteFound.id?t=this.clienteFound.id:(this.clienteForm.create_at=this.fechaCreacion,t=await v["a"].getInstance().save(this.clienteForm)),this.form.cliente_id=t,this.form.cliente_nombre=this.clienteForm.nombre,this.form.estado="PENDIENTE",this.clienteDialog=!1,await this.save(!0)}catch(t){console.error(t),this.$q.notify({type:"negative",message:"Error registrando cliente"})}finally{this.$q.loading.hide()}}else this.$q.notify({type:"warning",message:"Nombre y TelÃ©fono son requeridos"})},async confirmarFiadoExistente(){this.clienteFound&&(this.form.cliente_id=this.clienteFound.id,this.form.cliente_nombre=this.clienteFound.nombre,this.form.estado="PENDIENTE",this.clienteDialog=!1,await this.save())},async save(t=!1){this.$q.loading.show(),this.form.create_at=this.fechaCreacion,this.form.total=this.totalConIGTF,this.form.productos=this.lista_compras,this.form.metodo_pago=this.form.metodo_pago;let e=0,a=0,o=0;this.lista_compras.forEach((t=>{t.es_exento?e+=t.valor_bs:(a+=t.monto_base_bs,o+=t.monto_iva_bs)})),this.form.monto_exento=e,this.form.monto_base=a,this.form.monto_iva=o,this.form.tasa_iva=16,this.form.monto_igtf=this.montoIGTF,this.form.tasa_dolar=this.valor_dolar,["Efectivo $","Zelle"].includes(this.form.metodo_pago)?this.form.monto_dolar=this.total/this.valor_dolar:this.form.monto_dolar=0;try{let t=await g["a"].getInstance().get("secuencia_factura");t=t?Number(t)+1:1,this.form.numero_factura=t;const e=await c["a"].getInstance().save(this.form);await g["a"].getInstance().save("secuencia_factura",t);for(const a of this.lista_compras){const o=new m["a"];o.producto_id=a.id,o.tipo="SALIDA",o.cantidad=a.cantidad,o.fecha=Date.now(),o.referencia=`Venta #${e} (Fac: ${t})`,o.create_at=this.fechaCreacion,await u["a"].getInstance().save(o);const i=await d["a"].productos.get(a.id);if(i){let t=i.cantidad-a.cantidad;await d["a"].productos.update(a.id,{cantidad:t})}}this.form=new l["a"],this.form.cliente_id=null,this.form.cliente_nombre=null,this.form.estado="PAGADO",this.montoIGTF=0,this.totalConIGTF=0,this.lista_compras=[],this.total=0,this.$q.loading.hide(),_.train(),this.$q.notify({position:"top",type:"positive",message:`Venta registrada con Ã©xito. Factura #${t}`})}catch(i){console.error(`Error: ${i.stack||i}`),this.$q.loading.hide(),this.$q.notify({position:"top",type:"negative",message:`Error al guardar venta: ${i.message}`})}},eliminarProductoLista(t){console.log(t);this.lista_compras[t];this.lista_compras.splice(t,1),this.total=this.lista_compras.reduce(((t,e)=>t+e.valor_bs),0),["Efectivo $","Zelle"].includes(this.form.metodo_pago)&&this.tributos.cobrar_igtf?this.calcularIGTF():this.totalConIGTF=this.total},filterFn(t,e,a){t.length<2?a():e((()=>{const e=t.toLowerCase();this.options=this.stringOptions.filter((t=>t.toLowerCase().indexOf(e)>-1))}))},calcularPrecioUSD(t,e){return t&&e?parseFloat((t/e).toFixed(2)):0},async checkRecommendation(t){try{const e=this.lista_compras.map((t=>t.id)),a=await _.getRecommendation(t,e);a&&(this.recommendedProduct=a,this.$q.notify({message:`ðŸ’¡ Sugerencia: Clientes tambiÃ©n llevan ${a.nombre}`,caption:"Producto con poco movimiento disponible",color:"indigo-10",icon:"lightbulb",position:"bottom-right",timeout:1e4,actions:[{label:"Omitir",color:"white",handler:()=>{}},{label:"Agregar",color:"yellow",handler:()=>{this.confirmRecommendation()}}]}))}catch(e){console.error("Error checking recommendation:",e)}},confirmRecommendation(){this.recommendedProduct&&(this.producto=this.recommendedProduct.nombre,this.agregarListaCompra(),this.recommendedProduct=null)}}},y=b,w=(a("52c0"),a("2877")),q=a("9989"),C=a("f09f"),x=a("a370"),F=a("ddd8"),k=a("66e5"),I=a("4074"),S=a("0016"),D=a("27f9"),R=a("9c40"),$=a("cb32"),P=a("0170"),E=a("de5e"),A=a("24e8"),M=a("2c91"),T=a("4b7e"),N=a("7f67"),j=a("eebe"),O=a.n(j),G=Object(w["a"])(y,o,i,!1,null,"43a9012e",null);e["default"]=G.exports;O()(G,"components",{QPage:q["a"],QCard:C["a"],QCardSection:x["a"],QSelect:F["a"],QItem:k["a"],QItemSection:I["a"],QIcon:S["a"],QInput:D["a"],QBtn:R["a"],QAvatar:$["a"],QItemLabel:P["a"],QPageSticky:E["a"],QDialog:A["a"],QSpace:M["a"],QCardActions:T["a"]}),O()(G,"directives",{ClosePopup:N["a"]})},9751:function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));var o=a("4204");class i{static getInstance(){return new i}get(){return o["a"].clientes.toArray()}save(t){return o["a"].clientes.add(t)}update(t,e){return o["a"].clientes.update(t,e)}delete(t){return o["a"].clientes.delete(t)}getByCedula(t){return o["a"].clientes.get({cedula:t})}}},"9a27":function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));var o=a("4204");class i{static getInstance(){return new i}save(t){return o["a"].movimientos.add(t)}getAll(){return o["a"].movimientos.toArray()}getByProducto(t){return o["a"].movimientos.where("producto_id").equals(t).toArray()}getSalidasPorFecha(t,e){return o["a"].movimientos.where("fecha").between(t,e,!0,!0).filter((t=>"SALIDA"===t.tipo)).toArray()}getHistorialProducto(t){return o["a"].movimientos.where("producto_id").equals(t).sortBy("fecha")}}},abab:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));class o{constructor(){this.cedula="",this.nombre="",this.telefono="",this.create_at=null,this.update_at=null}}},b3d7:function(t,e,a){},c056:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));class o{constructor(){this.valor_dolar=null,this.create_at=null}}},dc92:function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));var o=a("4204");class i{static getInstance(){return new i}async get(t){const e=await o["a"].configuracion.get(t);return e?e.value:null}async save(t,e){return o["a"].configuracion.put({key:t,value:e})}}},dc98:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));class o{constructor(){this.producto_id=null,this.tipo="",this.cantidad=0,this.fecha=null,this.referencia="",this.create_at=null}}},e633:function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));var o=a("4204");a("bd4c");class i{static getInstance(){return new i}get(){return o["a"].valores_dolar.toArray()}save(t){return o["a"].valores_dolar.add(t)}getOne(t){return o["a"].valores_dolar.get({id:t})}delete(t){return o["a"].valores_dolar.delete(t)}getUltimo(){return o["a"].valores_dolar.orderBy("create_at").reverse().limit(1).first()}}},ed9b1:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));class o{constructor(){this.total=0,this.productos=[],this.metodo_pago="",this.numero_factura=0,this.cliente_id=null,this.cliente_nombre=null,this.estado="PAGADO",this.create_at=null}}}}]);