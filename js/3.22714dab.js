(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{3751:function(t,a,e){},"404a":function(t,a,e){"use strict";e.d(a,"a",(function(){return s}));e("caad");var o=e("4204");e("bd4c");class s{static getInstance(){return new s}get(t,a){const e=t&&t.includes(" ")?t:`${t} 00:00:00`,s=a&&a.includes(" ")?a:`${a} 23:59:59`;return console.log("ventasDAO.get - Fechas recibidas:",t,a),console.log("ventasDAO.get - Fechas completas:",e,s),o["a"].ventas.where("create_at").between(e,s,!0,!0).toArray().then((t=>(console.log("ventasDAO.get - Resultados encontrados:",t.length),t)))}save(t){return o["a"].ventas.add(t)}getOne(t){return o["a"].ventas.get({id:t})}delete(t){return o["a"].ventas.delete(t)}getNombre(t){return o["a"].ventas.get({nombre:t})}}},4204:function(t,a,e){"use strict";e.d(a,"a",(function(){return n}));var o=e("4dec"),s=e("c056"),i=e("dc98"),r=e("abab");const n=new o["a"]("BODEGUITA");n.version(1).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at",ventas:"++id, total, *productos, create_at, update_at"}),n.version(2).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad"}),n.version(3).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia"}),n.version(4).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo"}),n.version(5).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva"}),n.version(6).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),n.version(7).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),n.version(8).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value"}),n.version(9).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),n.version(10).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),n.version(11).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado, monto_exento, monto_base, monto_iva, tasa_iva, monto_igtf, tasa_dolar, monto_dolar",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),n.open().catch((function(t){console.error("Fallo al abrir la base de datos: "+(t.stack||t))})),n.valores_dolar.mapToClass(s["a"]),n.movimientos.mapToClass(i["a"]),n.clientes.mapToClass(r["a"])},"45e8":function(t,a,e){"use strict";e.d(a,"a",(function(){return s}));var o=e("4204");e("bd4c");class s{static getInstance(){return new s}get(){return o["a"].productos.toArray()}save(t){return o["a"].productos.add(t)}update(t,a){return o["a"].productos.update(t,a)}getOne(t){return o["a"].productos.get({id:t})}delete(t){return o["a"].productos.delete(t)}getNombre(t){return o["a"].productos.get({nombre:t})}}},8031:function(t,a,e){"use strict";e("3751")},abab:function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));class o{constructor(){this.cedula="",this.nombre="",this.telefono="",this.create_at=null,this.update_at=null}}},c056:function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));class o{constructor(){this.valor_dolar=null,this.create_at=null}}},dc92:function(t,a,e){"use strict";e.d(a,"a",(function(){return s}));var o=e("4204");class s{static getInstance(){return new s}async get(t){const a=await o["a"].configuracion.get(t);return a?a.value:null}async save(t,a){return o["a"].configuracion.put({key:t,value:a})}}},dc98:function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));class o{constructor(){this.producto_id=null,this.tipo="",this.cantidad=0,this.fecha=null,this.referencia="",this.create_at=null}}},e40a:function(t,a,e){"use strict";e.r(a);var o=function(){var t=this,a=t._self._c;return a("q-page",{staticClass:"q-pa-md bg-grey-1"},[a("div",{staticClass:"row items-center justify-between no-wrap q-mb-md"},[a("div",{staticClass:"text-h5 text-primary text-weight-bold col"},[t._v("Cierre de Caja (Reporte Z)")]),t.totalVenta>0?a("q-btn",{staticClass:"col-auto q-ml-sm",attrs:{color:"primary","icon-right":"share",label:"Compartir",outline:""},on:{click:t.compartirReporte}}):t._e()],1),a("q-card",{staticClass:"rounded-card shadow-1 q-mb-md bg-white"},[a("q-card-section",[a("div",{staticClass:"row q-col-gutter-sm items-center"},[a("div",{staticClass:"col-12 col-md-4"},[a("q-input",{staticClass:"rounded-borders",attrs:{filled:"",mask:"date",rules:["date"],label:"Fecha de Cierre"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{color:"primary"},on:{input:t.cargarDatos},model:{value:t.fecha,callback:function(a){t.fecha=a},expression:"fecha"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Cerrar",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.fecha,callback:function(a){t.fecha=a},expression:"fecha"}})],1),a("div",{staticClass:"col-12 col-md-8 text-right"},[a("div",{staticClass:"text-caption text-grey"},[t._v("Ultima actualización: "+t._s(t.updated_at))])])])])],1),a("div",{staticClass:"row q-col-gutter-md q-mb-lg"},[a("div",{staticClass:"col-12 col-md-4"},[a("q-card",{staticClass:"bg-primary text-white rounded-card shadow-2"},[a("q-card-section",[a("div",{staticClass:"text-subtitle2 text-indigo-2"},[t._v("Venta Total")]),a("div",{staticClass:"text-h4 text-indigo-1 text-weight-bold"},[t._v("Bs "+t._s(t.formatMoney(t.totalVenta)))]),t.valor_dolar?a("div",{staticClass:"text-caption text-indigo-1"},[t._v("\n            ≈ $ "+t._s(t.formatMoneyUSD(t.totalVenta/t.valor_dolar))+"\n          ")]):t._e()])],1)],1),a("div",{staticClass:"col-12 col-md-4"},[a("q-card",{staticClass:"bg-white text-dark rounded-card shadow-2"},[a("q-card-section",[a("div",{staticClass:"text-subtitle2 text-grey-7"},[t._v("Ganancia Estimada")]),a("div",{staticClass:"text-h4 text-weight-bold text-positive"},[t._v("Bs "+t._s(t.formatMoney(t.totalGanancia)))]),t.valor_dolar?a("div",{staticClass:"text-caption text-grey"},[t._v("\n            ≈ $ "+t._s(t.formatMoneyUSD(t.totalGanancia/t.valor_dolar))+"\n          ")]):t._e()])],1)],1),a("div",{staticClass:"col-12 col-md-4"},[a("q-card",{staticClass:"bg-white text-dark rounded-card shadow-2"},[a("q-card-section",[a("div",{staticClass:"text-subtitle2 text-grey-7"},[t._v("Transacciones")]),a("div",{staticClass:"text-h4 text-weight-bold"},[t._v(t._s(t.ventas.length))]),a("div",{staticClass:"text-caption text-grey"},[t._v("Registros de venta")])])],1)],1)]),a("div",{staticClass:"text-h6 q-mb-sm text-grey-8"},[t._v("Desglose por Método de Pago")]),a("div",{staticClass:"row q-col-gutter-md q-mb-lg"},t._l(t.desglosePagos,(function(e,o){return a("div",{key:o,staticClass:"col-12 col-sm-6 col-md-4"},[a("q-card",{staticClass:"rounded-card shadow-1"},[a("q-card-section",{staticClass:"row items-center"},[a("q-avatar",{staticClass:"q-mr-md",attrs:{color:"indigo-1","text-color":"primary",icon:"payments",size:"md"}}),a("div",[a("div",{staticClass:"text-caption text-grey"},[t._v(t._s(o||"Sin especificar"))]),a("div",{staticClass:"text-h6 text-primary text-weight-bold"},[t._v("Bs "+t._s(t.formatMoney(e)))]),t.valor_dolar?a("div",{staticClass:"text-caption text-grey-6"},[t._v("\n              $ "+t._s(t.formatMoneyUSD(e/t.valor_dolar))+"\n            ")]):t._e()])],1)],1)],1)})),0),a("div",{staticClass:"row justify-center q-mb-xl q-gutter-md"},[a("q-btn",{staticClass:"q-px-xl",staticStyle:{width:"350px"},attrs:{label:"Reporte X (Corte)",icon:"content_cut",color:"indigo-6",rounded:"",unelevated:""},on:{click:function(a){return t.abrirReporte("X")}}}),a("q-btn",{staticClass:"q-px-xl",staticStyle:{width:"350px"},attrs:{label:"Vista Fiscal (SENIAT)",icon:"receipt",color:"secondary",rounded:"",unelevated:""},on:{click:function(a){return t.abrirReporte("Z")}}})],1),a("q-dialog",{model:{value:t.modalFiscal,callback:function(a){t.modalFiscal=a},expression:"modalFiscal"}},[a("q-card",{staticStyle:{width:"400px","max-width":"90vw"}},[a("q-card-section",{staticClass:"row items-center q-pb-none print-hide"},[a("div",{staticClass:"text-h6"},[t._v("Reporte "+t._s(t.tipoReporte))]),a("q-space"),a("q-btn",{attrs:{icon:"print",flat:"",round:"",color:"primary"},on:{click:t.imprimirFiscal}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),a("q-card-section",{staticClass:"q-pt-sm scroll",staticStyle:{"max-height":"70vh","font-family":"'Courier New', Courier, monospace"}},[a("div",{staticClass:"text-center q-mb-md"},[a("div",{staticClass:"text-weight-bold"},[t._v(t._s(t.negocio.nombre))]),a("div",{staticClass:"text-caption"},[t._v("RIF: "+t._s(t.negocio.rif))]),a("div",{staticClass:"text-caption"},[t._v("Dirección Fiscal: "+t._s(t.negocio.direccion))])]),a("div",{staticClass:"text-center q-py-sm border-y"},[a("div",{staticClass:"text-weight-bold"},[t._v(t._s(t.tituloReporte))]),"Z"===t.tipoReporte?a("div",[t._v("Nro: "+t._s(t.reporteNumero))]):t._e()]),a("div",{staticClass:"row justify-between q-mt-sm"},[a("div",[t._v("Fecha: "+t._s(t.fecha))]),a("div",[t._v("Hora: "+t._s(t.updated_at))])]),a("div",{staticClass:"row justify-between"},[a("div",[t._v("Fac. Inicial:")]),a("div",[t._v(t._s(t.facInicial))])]),a("div",{staticClass:"row justify-between"},[a("div",[t._v("Fac. Final:")]),a("div",[t._v(t._s(t.facFinal))])]),a("div",{staticClass:"row justify-between"},[a("div",[t._v("Cant. Facturas:")]),a("div",[t._v(t._s(t.ventas.length))])]),a("q-separator",{staticClass:"q-my-sm"}),a("div",{staticClass:"row justify-between text-weight-bold"},[a("div",[t._v("DESCRIPCION")]),a("div",[t._v("MONTO")])]),t.tributos.cobrar_iva?a("div",[a("div",{staticClass:"row justify-between q-mt-xs"},[a("div",[t._v("Exento (E)")]),a("div",[t._v(t._s(t.formatMoney(t.fiscal.exento)))])]),a("div",{staticClass:"row justify-between"},[a("div",[t._v("Base Imponible (G) 16%")]),a("div",[t._v(t._s(t.formatMoney(t.fiscal.base)))])]),a("div",{staticClass:"row justify-between"},[a("div",[t._v("Impuesto (IVA) 16%")]),a("div",[t._v(t._s(t.formatMoney(t.fiscal.iva)))])])]):t._e(),t.tributos.cobrar_igtf&&t.fiscal.igtf>0?a("div",[a("div",{staticClass:"row justify-between"},[a("div",[t._v("IGTF (3%)")]),a("div",[t._v(t._s(t.formatMoney(t.fiscal.igtf)))])])]):t._e(),t.tributos.cobrar_iva||t.tributos.cobrar_igtf?t._e():a("div",[a("div",{staticClass:"row justify-between q-mt-xs"},[a("div",[t._v("Ventas Exentas")]),a("div",[t._v(t._s(t.formatMoney(t.totalVenta)))])])]),a("q-separator",{staticClass:"q-my-sm"}),a("div",{staticClass:"row justify-between text-h6 text-weight-bold"},[a("div",[t._v("TOTAL VENTAS")]),a("div",[t._v(t._s(t.formatMoney(t.totalVenta)))])]),a("q-separator",{staticClass:"q-my-sm dashed"}),a("div",{staticClass:"text-center q-mt-lg"},[a("div",{staticClass:"text-weight-bold"},[t._v("MH-1234567890")]),a("div",{staticClass:"text-caption"},[t._v("NO FISCAL - REFERENCIAL")])])],1)],1)],1)],1)},s=[],i=(e("ddb0"),e("bd4c")),r=e("404a"),n=e("e633"),c=(e("45e8"),e("dc92")),d={name:"CierreCaja",data(){return{fecha:i["b"].formatDate(Date.now(),"YYYY/MM/DD"),ventas:[],valor_dolar:null,updated_at:"",modalFiscal:!1,tipoReporte:"Z",negocio:{nombre:"BODEGUITA",rif:"J-12345678-9",direccion:"Calle Principal, Local 1"},tributos:{cobrar_iva:!1,cobrar_igtf:!1}}},computed:{tituloReporte(){return"Z"===this.tipoReporte?"REPORTE GLOBAL Z":"REPORTE X - CORTE"},totalVenta(){return this.ventas.reduce(((t,a)=>t+(a.total||0)),0)},totalCosto(){return this.ventas.reduce(((t,a)=>{const e=a.productos.reduce(((t,a)=>t+(a.costo_total_bs||0)),0);return t+e}),0)},totalGanancia(){return this.totalVenta-this.totalCosto},desglosePagos(){const t={};return this.ventas.forEach((a=>{const e=a.metodo_pago||"Desconocido";t[e]||(t[e]=0),t[e]+=a.total||0})),t},facInicial(){if(0===this.ventas.length)return"000000";const t=Math.min(...this.ventas.map((t=>t.numero_factura||t.id)));return t.toString().padStart(6,"0")},facFinal(){if(0===this.ventas.length)return"000000";const t=Math.max(...this.ventas.map((t=>t.numero_factura||t.id)));return t.toString().padStart(6,"0")},reporteNumero(){return i["b"].formatDate(Date.now(),"YYDDD")},fiscal(){let t=0,a=0,e=0,o=0;this.ventas.forEach((s=>{t+=s.monto_exento||0,a+=s.monto_base||0,e+=s.monto_iva||0,o+=s.monto_igtf||0}));const s=t+a+e+o,i=this.totalVenta-s;return i>.01&&(t+=i),{exento:t,base:a,iva:e,igtf:o}}},mounted(){this.init()},methods:{async init(){await this.getDolar(),await this.cargarConfig(),await this.cargarDatos()},abrirReporte(t){this.tipoReporte=t,this.modalFiscal=!0},async cargarConfig(){const t=await c["a"].getInstance().get("datos_negocio");t&&(this.negocio=t,this.negocio.nombre||(this.negocio.nombre="BODEGUITA"),this.negocio.rif||(this.negocio.rif="J-12345678-9"),this.negocio.direccion||(this.negocio.direccion="Calle Principal"));const a=await c["a"].getInstance().get("tributos");a&&(this.tributos={...a})},async getDolar(){const t=await n["a"].getInstance().getUltimo();t&&(this.valor_dolar=t.valor_dolar)},async cargarDatos(){this.$q.loading.show();try{this.ventas=await r["a"].getInstance().get(this.fecha,this.fecha),this.updated_at=i["b"].formatDate(Date.now(),"HH:mm:ss")}catch(t){console.error(t),this.$q.notify({type:"negative",message:"Error cargando ventas"})}finally{this.$q.loading.hide()}},formatMoney(t){return new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},formatMoneyUSD(t){return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},async imprimirFiscal(){await this.$nextTick(),window.print()},compartirReporte(){let t=`*Reporte Z - ${this.fecha}*\n\n`;t+=`*Venta Total:* Bs ${this.formatMoney(this.totalVenta)}\n`,this.valor_dolar&&(t+=`*Equivalente:* $ ${this.formatMoneyUSD(this.totalVenta/this.valor_dolar)}\n`),t+=`*Transacciones:* ${this.ventas.length}\n\n`,t+="*Desglose por Pago:*\n";for(const[e,o]of Object.entries(this.desglosePagos))t+=`- ${e}: Bs ${this.formatMoney(o)}\n`;this.tributos.cobrar_iva&&(t+="\n*Fiscal:*\n",t+=`Base: ${this.formatMoney(this.fiscal.base)}\n`,t+=`IVA: ${this.formatMoney(this.fiscal.iva)}\n`);const a=`https://api.whatsapp.com/send?text=${encodeURIComponent(t)}`;window.open(a,"_blank")}}},l=d,u=(e("8031"),e("2877")),v=e("9989"),_=e("9c40"),p=e("f09f"),m=e("a370"),f=e("27f9"),g=e("0016"),h=e("7cbe"),b=e("52ee"),C=e("cb32"),w=e("24e8"),y=e("2c91"),x=e("eb85"),q=e("7f67"),D=e("eebe"),j=e.n(D),F=Object(u["a"])(l,o,s,!1,null,"5004ce7f",null);a["default"]=F.exports;j()(F,"components",{QPage:v["a"],QBtn:_["a"],QCard:p["a"],QCardSection:m["a"],QInput:f["a"],QIcon:g["a"],QPopupProxy:h["a"],QDate:b["a"],QAvatar:C["a"],QDialog:w["a"],QSpace:y["a"],QSeparator:x["a"]}),j()(F,"directives",{ClosePopup:q["a"]})},e633:function(t,a,e){"use strict";e.d(a,"a",(function(){return s}));var o=e("4204");e("bd4c");class s{static getInstance(){return new s}get(){return o["a"].valores_dolar.toArray()}save(t){return o["a"].valores_dolar.add(t)}getOne(t){return o["a"].valores_dolar.get({id:t})}delete(t){return o["a"].valores_dolar.delete(t)}getUltimo(){return o["a"].valores_dolar.orderBy("create_at").reverse().limit(1).first()}}}}]);