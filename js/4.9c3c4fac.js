(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"0a3f":function(t,e,a){},1657:function(t,e,a){"use strict";a("0a3f")},2826:function(t,e,a){"use strict";a.r(e);var o=function(){var t,e,a,o,r=this,n=r._self._c;return n("q-page",{staticClass:"q-pa-md bg-grey-1"},[n("div",{staticClass:"row items-center q-mb-md"},[n("div",{staticClass:"text-h6 text-primary"},[r._v("Cuentas por Cobrar (Fiado)")]),n("q-space"),n("div",{staticClass:"text-subtitle1 text-grey-8"},[r._v("\n            Total Pendiente: "),n("strong",[r._v("Bs "+r._s(r.formatMoney(r.totalPendiente)))]),r.valor_dolar?n("span",{staticClass:"text-caption q-ml-sm"},[r._v("($ "+r._s(r.formatMoneyUSD(r.totalPendiente/r.valor_dolar))+")")]):r._e()])],1),n("q-card",{staticClass:"rounded-card shadow-1"},[n("q-table",{attrs:{title:"Ventas Pendientes",data:r.ventasPendientes,columns:r.columns,"row-key":"id",filter:r.filter,pagination:r.pagination},scopedSlots:r._u([{key:"top-right",fn:function(){return[n("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Buscar"},scopedSlots:r._u([{key:"append",fn:function(){return[n("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:r.filter,callback:function(t){r.filter=t},expression:"filter"}})]},proxy:!0},{key:"body-cell-fecha",fn:function(t){return[n("q-td",{attrs:{props:t}},[r._v("\n                    "+r._s(r.formatDate(t.row.create_at))+"\n                ")])]}},{key:"body-cell-total",fn:function(t){return[n("q-td",{staticClass:"text-weight-bold",attrs:{props:t}},[r._v("\n                    Bs "+r._s(r.formatMoney(t.row.total))+"\n                    "),r.valor_dolar?n("div",{staticClass:"text-caption text-grey"},[r._v("\n                        $ "+r._s(r.formatMoneyUSD(t.row.total/r.valor_dolar))+"\n                    ")]):r._e()])]}},{key:"body-cell-pagado",fn:function(t){return[n("q-td",{attrs:{props:t}},[r._v("\n                    Bs "+r._s(r.formatMoney(t.row.monto_pagado))+"\n                ")])]}},{key:"body-cell-restante",fn:function(t){return[n("q-td",{staticClass:"text-weight-bold text-negative",attrs:{props:t}},[r._v("\n                    Bs "+r._s(r.formatMoney(t.row.restante))+"\n                    "),r.valor_dolar?n("div",{staticClass:"text-caption text-grey"},[r._v("\n                        $ "+r._s(r.formatMoneyUSD(t.row.restante/r.valor_dolar))+"\n                    ")]):r._e()])]}},{key:"body-cell-acciones",fn:function(t){return[n("q-td",{attrs:{props:t,"auto-width":""}},[n("q-btn",{attrs:{flat:"",round:"",color:"primary",icon:"visibility"},on:{click:function(e){return r.verDetalle(t.row)}}},[n("q-tooltip",[r._v("Ver Detalle")])],1),n("q-btn",{attrs:{flat:"",round:"",color:"green",icon:"attach_money"},on:{click:function(e){return r.abrirDialogoPago(t.row)}}},[n("q-tooltip",[r._v("Registrar Pago")])],1)],1)]}}])})],1),n("q-dialog",{model:{value:r.detalleDialog,callback:function(t){r.detalleDialog=t},expression:"detalleDialog"}},[n("q-card",{staticStyle:{"min-width":"350px"}},[n("q-card-section",[n("div",{staticClass:"text-h6"},[r._v("Detalle de Venta #"+r._s(null===(t=r.selectedVenta)||void 0===t?void 0:t.numero_factura))]),n("div",{staticClass:"text-subtitle2"},[r._v(r._s(null===(e=r.selectedVenta)||void 0===e?void 0:e.cliente_nombre)+" - "+r._s(r.formatDate(null===(a=r.selectedVenta)||void 0===a?void 0:a.create_at))+"\n                ")])]),n("q-card-section",[n("q-list",{attrs:{dense:"",separator:""}},r._l(null===(o=r.selectedVenta)||void 0===o?void 0:o.productos,(function(t,e){return n("q-item",{key:e},[n("q-item-section",[n("q-item-label",[r._v(r._s(t.producto))]),n("q-item-label",{attrs:{caption:""}},[r._v("Cant: "+r._s(t.cantidad))])],1),n("q-item-section",{attrs:{side:""}},[r._v("\n                            Bs "+r._s(r.formatMoney(t.valor_bs))+"\n                        ")])],1)})),1)],1),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cerrar",color:"primary"}})],1)],1)],1),n("q-dialog",{model:{value:r.paymentDialog,callback:function(t){r.paymentDialog=t},expression:"paymentDialog"}},[n("q-card",{staticStyle:{"min-width":"350px"}},[n("q-card-section",{staticClass:"row items-center"},[n("div",{staticClass:"text-h6"},[r._v("Registrar Pago")]),n("q-space"),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),n("q-card-section",{staticClass:"q-pt-none"},[n("div",{staticClass:"text-subtitle1 q-mb-sm"},[r._v("\n                    Deuda Restante: "),n("span",{staticClass:"text-negative text-weight-bold"},[r._v("Bs "+r._s(r.formatMoney(r.paymentForm.max)))])]),n("q-input",{attrs:{filled:"",label:"Monto a Pagar",type:"number",prefix:"Bs",autofocus:"",step:"0.01",rules:[t=>t>0||"El monto debe ser mayor a 0",t=>t<=r.paymentForm.max||"Monto excede deuda"]},model:{value:r.paymentForm.amount,callback:function(t){r.$set(r.paymentForm,"amount",t)},expression:"paymentForm.amount"}})],1),n("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[n("q-btn",{attrs:{flat:"",label:"Pagar Totalidad",color:"secondary"},on:{click:r.setPagoCompleto}}),n("q-btn",{attrs:{flat:"",label:"Abonar",color:"primary"},on:{click:r.procesarPago}})],1)],1)],1)],1)},r=[],n=(a("ddb0"),a("bd4c")),i=(a("404a"),a("e633")),s=a("4204"),l={name:"CuentasPorCobrar",data(){return{ventasPendientes:[],valor_dolar:null,filter:"",pagination:{rowsPerPage:10},columns:[{name:"fecha",align:"left",label:"Fecha",field:"create_at",sortable:!0},{name:"cedula",align:"left",label:"Cédula",field:"cliente_cedula",sortable:!0},{name:"cliente",align:"left",label:"Cliente",field:"cliente_nombre",sortable:!0},{name:"factura",align:"center",label:"N° Factura",field:"numero_factura",sortable:!0},{name:"total",align:"right",label:"Total",field:"total",sortable:!0},{name:"pagado",align:"right",label:"Abonado",field:"monto_pagado",sortable:!0},{name:"restante",align:"right",label:"Restante",field:"restante",sortable:!0},{name:"acciones",align:"center",label:"Acciones",field:"acciones"}],detalleDialog:!1,paymentDialog:!1,selectedVenta:null,totalPendiente:0,paymentForm:{amount:0,max:0}}},mounted(){this.getDolar(),this.getVentasPendientes()},methods:{formatMoney(t){return new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t||0)},formatMoneyUSD(t){return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t||0)},formatDate(t){return t?n["b"].formatDate(t,"DD/MM/YYYY hh:mm A"):""},getDolar(){i["a"].getInstance().getUltimo().then((t=>{this.valor_dolar=t.valor_dolar}))},async getVentasPendientes(){const t=await s["a"].ventas.where("estado").equals("PENDIENTE").toArray();this.ventasPendientes=await Promise.all(t.map((async t=>{let e={};t.cliente_id&&(e=await s["a"].clientes.get(t.cliente_id)||{});const a=Number((t.monto_pagado||0).toFixed(2)),o=Number((t.total-a).toFixed(2)),r=e.nombre||t.cliente_nombre||"Cliente Desconocido",n=e.cedula||"S/C";return{...t,cliente_cedula:n,cliente_nombre:r,monto_pagado:a,restante:o}}))),this.calculateTotal()},calculateTotal(){this.totalPendiente=this.ventasPendientes.reduce(((t,e)=>t+Number(e.restante)),0)},verDetalle(t){this.selectedVenta=t,this.detalleDialog=!0},abrirDialogoPago(t){this.selectedVenta=t,this.paymentForm.amount=0,this.paymentForm.max=t.restante,this.paymentDialog=!0},setPagoCompleto(){this.paymentForm.amount=this.paymentForm.max},async procesarPago(){const t=Number(Number(this.paymentForm.amount).toFixed(2));if(t<=0)this.$q.notify({type:"warning",message:"El monto debe ser mayor a 0"});else if(t>this.paymentForm.max)this.$q.notify({type:"negative",message:"El monto excede la deuda restante"});else try{const e=(this.selectedVenta.monto_pagado||0)+t,a=e>=this.selectedVenta.total?"PAGADO":"PENDIENTE";await s["a"].ventas.update(this.selectedVenta.id,{monto_pagado:e,estado:a,update_at:n["b"].formatDate(Date.now(),"YYYY/MM/DD HH:mm:ss")}),this.$q.notify({type:"positive",message:"Pago registrado exitosamente"}),this.paymentDialog=!1,this.getVentasPendientes()}catch(e){console.error(e),this.$q.notify({type:"negative",message:"Error al registrar el pago"})}}}},c=l,d=(a("1657"),a("2877")),u=a("9989"),m=a("2c91"),p=a("f09f"),_=a("eaac"),v=a("27f9"),f=a("0016"),g=a("db86"),b=a("9c40"),h=a("05c0"),y=a("24e8"),q=a("a370"),D=a("1c1c"),x=a("66e5"),w=a("4074"),C=a("0170"),P=a("4b7e"),F=a("7f67"),k=a("eebe"),j=a.n(k),M=Object(d["a"])(c,o,r,!1,null,"c5f6e05e",null);e["default"]=M.exports;j()(M,"components",{QPage:u["a"],QSpace:m["a"],QCard:p["a"],QTable:_["a"],QInput:v["a"],QIcon:f["a"],QTd:g["a"],QBtn:b["a"],QTooltip:h["a"],QDialog:y["a"],QCardSection:q["a"],QList:D["a"],QItem:x["a"],QItemSection:w["a"],QItemLabel:C["a"],QCardActions:P["a"]}),j()(M,"directives",{ClosePopup:F["a"]})},"404a":function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));a("caad");var o=a("4204");a("bd4c");class r{static getInstance(){return new r}get(t,e){const a=t&&t.includes(" ")?t:`${t} 00:00:00`,r=e&&e.includes(" ")?e:`${e} 23:59:59`;return console.log("ventasDAO.get - Fechas recibidas:",t,e),console.log("ventasDAO.get - Fechas completas:",a,r),o["a"].ventas.where("create_at").between(a,r,!0,!0).toArray().then((t=>(console.log("ventasDAO.get - Resultados encontrados:",t.length),t)))}save(t){return o["a"].ventas.add(t)}getOne(t){return o["a"].ventas.get({id:t})}delete(t){return o["a"].ventas.delete(t)}getNombre(t){return o["a"].ventas.get({nombre:t})}}},4204:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var o=a("4dec"),r=a("c056"),n=a("dc98"),i=a("abab");const s=new o["a"]("BODEGUITA");s.version(1).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at",ventas:"++id, total, *productos, create_at, update_at"}),s.version(2).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad"}),s.version(3).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia"}),s.version(4).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo"}),s.version(5).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva"}),s.version(6).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),s.version(7).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),s.version(8).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value"}),s.version(9).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),s.version(10).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),s.version(11).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado, monto_exento, monto_base, monto_iva, tasa_iva, monto_igtf, tasa_dolar, monto_dolar",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),s.open().catch((function(t){console.error("Fallo al abrir la base de datos: "+(t.stack||t))})),s.valores_dolar.mapToClass(r["a"]),s.movimientos.mapToClass(n["a"]),s.clientes.mapToClass(i["a"])},abab:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));class o{constructor(){this.cedula="",this.nombre="",this.telefono="",this.create_at=null,this.update_at=null}}},c056:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));class o{constructor(){this.valor_dolar=null,this.create_at=null}}},dc98:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));class o{constructor(){this.producto_id=null,this.tipo="",this.cantidad=0,this.fecha=null,this.referencia="",this.create_at=null}}},e633:function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));var o=a("4204");a("bd4c");class r{static getInstance(){return new r}get(){return o["a"].valores_dolar.toArray()}save(t){return o["a"].valores_dolar.add(t)}getOne(t){return o["a"].valores_dolar.get({id:t})}delete(t){return o["a"].valores_dolar.delete(t)}getUltimo(){return o["a"].valores_dolar.orderBy("create_at").reverse().limit(1).first()}}}}]);