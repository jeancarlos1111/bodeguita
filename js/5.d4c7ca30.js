(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"0966":function(t,e,a){"use strict";a("8d7d")},"404a":function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));a("caad");var o=a("4204");a("bd4c");class r{static getInstance(){return new r}get(t,e){const a=t&&t.includes(" ")?t:`${t} 00:00:00`,r=e&&e.includes(" ")?e:`${e} 23:59:59`;return console.log("ventasDAO.get - Fechas recibidas:",t,e),console.log("ventasDAO.get - Fechas completas:",a,r),o["a"].ventas.where("create_at").between(a,r,!0,!0).toArray().then((t=>(console.log("ventasDAO.get - Resultados encontrados:",t.length),t)))}save(t){return o["a"].ventas.add(t)}getOne(t){return o["a"].ventas.get({id:t})}delete(t){return o["a"].ventas.delete(t)}getNombre(t){return o["a"].ventas.get({nombre:t})}}},4204:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var o=a("4dec"),r=a("c056"),n=a("dc98"),i=a("abab");const s=new o["a"]("BODEGUITA");s.version(1).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at",ventas:"++id, total, *productos, create_at, update_at"}),s.version(2).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad"}),s.version(3).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia"}),s.version(4).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo"}),s.version(5).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva"}),s.version(6).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),s.version(7).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),s.version(8).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value"}),s.version(9).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),s.version(10).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),s.version(11).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado, monto_exento, monto_base, monto_iva, tasa_iva, monto_igtf, tasa_dolar, monto_dolar",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),s.open().catch((function(t){console.error("Fallo al abrir la base de datos: "+(t.stack||t))})),s.valores_dolar.mapToClass(r["a"]),s.movimientos.mapToClass(n["a"]),s.clientes.mapToClass(i["a"])},"5ee8":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("q-page",{staticClass:"q-pa-md bg-grey-1"},[e("div",{staticClass:"row items-center justify-between no-wrap q-mb-md"},[e("div",{staticClass:"text-h5 text-primary text-weight-bold col"},[t._v("Libro de Ventas")]),e("div",{staticClass:"col-auto"},[e("q-btn",{attrs:{icon:"download",label:"Exportar CSV",color:"positive",disable:!t.ventasMensuales.length,outline:"",rounded:""},on:{click:t.exportCSV}})],1)]),e("q-card",{staticClass:"rounded-card shadow-1 q-mb-md bg-white"},[e("q-card-section",[e("div",{staticClass:"row q-col-gutter-sm items-center"},[e("div",{staticClass:"col-6 col-md-3"},[e("q-select",{attrs:{filled:"",options:t.meses,label:"Mes","emit-value":"","map-options":""},on:{input:t.cargarLibro},model:{value:t.mes,callback:function(e){t.mes=e},expression:"mes"}})],1),e("div",{staticClass:"col-6 col-md-3"},[e("q-input",{attrs:{filled:"",type:"number",label:"Año"},on:{input:t.cargarLibro},model:{value:t.anio,callback:function(e){t.anio=t._n(e)},expression:"anio"}})],1),e("div",{staticClass:"col-12 col-md-6 text-right"},[e("div",{staticClass:"text-h6 text-primary"},[t._v("\n                        Total Mes: Bs "+t._s(t.formatMoney(t.totalMes))+"\n                    ")]),e("div",{staticClass:"text-caption text-grey"},[t._v("Base: "+t._s(t.formatMoney(t.totalBase))+" | IVA: "+t._s(t.formatMoney(t.totalIVA))+" | IGTF: "+t._s(t.formatMoney(t.totalIGTF)))])])])])],1),e("q-table",{staticClass:"rounded-card shadow-1",attrs:{data:t.ventasMensuales,columns:t.columns,"row-key":"id",pagination:t.pagination,"no-data-label":"No hay registros para este mes"},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"body-cell-fecha",fn:function(a){return[e("q-td",{attrs:{props:a}},[t._v("\n                "+t._s(t.formatDate(a.row.create_at))+"\n            ")])]}},{key:"body-cell-cliente",fn:function(a){return[e("q-td",{attrs:{props:a}},[e("div",{staticClass:"text-weight-bold"},[t._v(t._s(a.row.cliente_nombre||"Cliente Genérico"))]),e("div",{staticClass:"text-caption text-grey"},[t._v(t._s(a.row.cliente_cedula||"Varios"))])])]}},{key:"body-cell-factura",fn:function(a){return[e("q-td",{attrs:{props:a}},[e("q-badge",{attrs:{color:"indigo-1","text-color":"primary"}},[t._v("\n                    "+t._s(String(a.row.numero_factura||"0").padStart(6,"0"))+"\n                ")])],1)]}},{key:"body-cell-total",fn:function(a){return[e("q-td",{staticClass:"text-weight-bold text-primary",attrs:{props:a}},[t._v("\n                "+t._s(t.formatMoney(a.row.total))+"\n            ")])]}}])})],1)},r=[],n=(a("ddb0"),a("5319"),a("2b3d"),a("9861"),a("bd4c")),i=a("404a"),s=a("9751"),c={name:"LibroVentas",data(){return{mes:(new Date).getMonth()+1,anio:(new Date).getFullYear(),meses:[{label:"Enero",value:1},{label:"Febrero",value:2},{label:"Marzo",value:3},{label:"Abril",value:4},{label:"Mayo",value:5},{label:"Junio",value:6},{label:"Julio",value:7},{label:"Agosto",value:8},{label:"Septiembre",value:9},{label:"Octubre",value:10},{label:"Noviembre",value:11},{label:"Diciembre",value:12}],ventasMensuales:[],pagination:{rowsPerPage:20},columns:[{name:"fecha",align:"left",label:"Fecha",field:"create_at",sortable:!0},{name:"factura",align:"center",label:"Nro Fact",field:"numero_factura",sortable:!0},{name:"cliente",align:"left",label:"Cliente (RIF/Nombre)",field:"cliente_nombre"},{name:"total",align:"right",label:"Total Venta",field:"total",format:t=>this.formatMoney(t)},{name:"exento",align:"right",label:"Exento",field:"monto_exento",format:t=>this.formatMoney(t)},{name:"base",align:"right",label:"Base Imp.",field:"monto_base",format:t=>this.formatMoney(t)},{name:"iva",align:"right",label:"IVA (16%)",field:"monto_iva",format:t=>this.formatMoney(t)},{name:"igtf",align:"right",label:"IGTF (3%)",field:"monto_igtf",format:t=>this.formatMoney(t)}]}},computed:{totalMes(){return this.ventasMensuales.reduce(((t,e)=>t+(e.total||0)),0)},totalBase(){return this.ventasMensuales.reduce(((t,e)=>t+(e.monto_base||0)),0)},totalIVA(){return this.ventasMensuales.reduce(((t,e)=>t+(e.monto_iva||0)),0)},totalIGTF(){return this.ventasMensuales.reduce(((t,e)=>t+(e.monto_igtf||0)),0)}},mounted(){this.cargarLibro()},methods:{formatMoney(t){return void 0===t||null===t?"0,00":new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},formatDate(t){return n["b"].formatDate(t,"DD/MM/YYYY")},async cargarLibro(){this.$q.loading.show();try{const t=String(this.mes).padStart(2,"0"),e=`${this.anio}/${t}/01`,a=new Date(this.anio,this.mes,0).getDate(),o=`${this.anio}/${t}/${a}`,r=await i["a"].getInstance().get(e,o),n=await Promise.all(r.map((async t=>{let e="S/C";if(t.cliente_id){const a=await s["a"].getInstance().get(t.cliente_id);a&&(e=a.cedula)}return{...t,cliente_cedula:e}})));this.ventasMensuales=n.sort(((t,e)=>(t.numero_factura||0)-(e.numero_factura||0)))}catch(t){console.error(t),this.$q.notify({type:"negative",message:"Error cargando libro"})}finally{this.$q.loading.hide()}},exportCSV(){const t=["Fecha","Nro Fact","Nro Control","Nombre Cliente","RIF/Cedula","Total Venta","Monto Exento","Base Imponible","IVA","IGTF"];let e=t.join(";")+"\n";this.ventasMensuales.forEach((t=>{const a=[this.formatDate(t.create_at),String(t.numero_factura).padStart(6,"0"),String(t.numero_factura).padStart(6,"0"),`"${t.cliente_nombre||"Cliente Genérico"}"`,t.cliente_cedula||"",Number(t.total||0).toFixed(2).replace(".",","),Number(t.monto_exento||0).toFixed(2).replace(".",","),Number(t.monto_base||0).toFixed(2).replace(".",","),Number(t.monto_iva||0).toFixed(2).replace(".",","),Number(t.monto_igtf||0).toFixed(2).replace(".",",")];e+=a.join(";")+"\n"}));const a=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),r=URL.createObjectURL(a);o.setAttribute("href",r),o.setAttribute("download",`Libro_Ventas_${this.mes}_${this.anio}.csv`),document.body.appendChild(o),o.click(),document.body.removeChild(o)}}},l=c,d=(a("0966"),a("2877")),u=a("9989"),_=a("9c40"),m=a("f09f"),p=a("a370"),v=a("ddd8"),f=a("27f9"),b=a("eaac"),g=a("db86"),h=a("58a8"),y=a("eebe"),w=a.n(y),x=Object(d["a"])(l,o,r,!1,null,"dc496532",null);e["default"]=x.exports;w()(x,"components",{QPage:u["a"],QBtn:_["a"],QCard:m["a"],QCardSection:p["a"],QSelect:v["a"],QInput:f["a"],QTable:b["a"],QTd:g["a"],QBadge:h["a"]})},"8d7d":function(t,e,a){},9751:function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));var o=a("4204");class r{static getInstance(){return new r}get(){return o["a"].clientes.toArray()}save(t){return o["a"].clientes.add(t)}update(t,e){return o["a"].clientes.update(t,e)}delete(t){return o["a"].clientes.delete(t)}getByCedula(t){return o["a"].clientes.get({cedula:t})}}},abab:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));class o{constructor(){this.cedula="",this.nombre="",this.telefono="",this.create_at=null,this.update_at=null}}},c056:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));class o{constructor(){this.valor_dolar=null,this.create_at=null}}},dc98:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));class o{constructor(){this.producto_id=null,this.tipo="",this.cantidad=0,this.fecha=null,this.referencia="",this.create_at=null}}}}]);