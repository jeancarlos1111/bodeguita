(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{4028:function(t,a,e){},"404a":function(t,a,e){"use strict";e.d(a,"a",(function(){return r}));e("caad");var o=e("4204");e("bd4c");class r{static getInstance(){return new r}get(t,a){const e=t&&t.includes(" ")?t:`${t} 00:00:00`,r=a&&a.includes(" ")?a:`${a} 23:59:59`;return console.log("ventasDAO.get - Fechas recibidas:",t,a),console.log("ventasDAO.get - Fechas completas:",e,r),o["a"].ventas.where("create_at").between(e,r,!0,!0).toArray().then((t=>(console.log("ventasDAO.get - Resultados encontrados:",t.length),t)))}save(t){return o["a"].ventas.add(t)}getOne(t){return o["a"].ventas.get({id:t})}delete(t){return o["a"].ventas.delete(t)}getNombre(t){return o["a"].ventas.get({nombre:t})}}},4204:function(t,a,e){"use strict";e.d(a,"a",(function(){return i}));var o=e("4dec"),r=e("c056"),s=e("dc98"),n=e("abab");const i=new o["a"]("BODEGUITA");i.version(1).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at",ventas:"++id, total, *productos, create_at, update_at"}),i.version(2).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad"}),i.version(3).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia"}),i.version(4).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo"}),i.version(5).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva"}),i.version(6).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),i.version(7).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),i.version(8).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value"}),i.version(9).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),i.version(10).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),i.version(11).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado, monto_exento, monto_base, monto_iva, tasa_iva, monto_igtf, tasa_dolar, monto_dolar",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),i.open().catch((function(t){console.error("Fallo al abrir la base de datos: "+(t.stack||t))})),i.valores_dolar.mapToClass(r["a"]),i.movimientos.mapToClass(s["a"]),i.clientes.mapToClass(n["a"])},abab:function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));class o{constructor(){this.cedula="",this.nombre="",this.telefono="",this.create_at=null,this.update_at=null}}},b1ec:function(t,a,e){"use strict";e("4028")},c056:function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));class o{constructor(){this.valor_dolar=null,this.create_at=null}}},c0f7:function(t,a,e){"use strict";e.r(a);var o=function(){var t=this,a=t._self._c;t._self._setupProxy;return a("q-page",{staticClass:"bg-grey-3 q-pa-md",attrs:{padding:""}},[a("div",{staticClass:"row q-mb-md"},[a("q-input",{staticClass:"col q-mr-sm",attrs:{filled:"",mask:"date",rules:["date"],label:"Fecha Inicio"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{model:{value:t.inicio,callback:function(a){t.inicio=a},expression:"inicio"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Cerrar",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.inicio,callback:function(a){t.inicio=a},expression:"inicio"}}),a("q-input",{staticClass:"col",attrs:{filled:"",mask:"date",rules:["date"],label:"Fecha Fin"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{on:{input:t.cargarDatos},model:{value:t.fin,callback:function(a){t.fin=a},expression:"fin"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Cerrar",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.fin,callback:function(a){t.fin=a},expression:"fin"}})],1),a("q-card",{staticClass:"q-mb-md"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("Ventas por Producto")]),a("div",{staticClass:"text-caption text-grey-7"},[t._v("\n        Total de ventas agrupadas por producto en el rango seleccionado\n      ")])]),a("q-card-section",[a("canvas",{ref:"chartCanvas"})])],1),t.datosProductos.length>0?a("q-card",[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("Resumen de Ventas")])]),a("q-card-section",[a("q-markup-table",[a("thead",[a("tr",[a("th",{staticClass:"text-left"},[t._v("Producto")]),a("th",{staticClass:"text-right"},[t._v("Cantidad Vendida")]),a("th",{staticClass:"text-right"},[t._v("Total Ventas (Bs)")])])]),a("tbody",t._l(t.productosList,(function(e,o){return a("tr",{key:o},[a("td",{staticClass:"text-left"},[t._v(t._s(e.producto))]),a("td",{staticClass:"text-right"},[t._v(t._s(e.cantidadTotal))]),a("td",{staticClass:"text-right"},[t._v("\n              "+t._s(new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.totalVentas))+"\n            ")])])})),0)])],1)],1):t._e(),0===t.datosProductos.length?a("q-banner",{staticClass:"bg-info text-white"},[t._v("\n    No hay datos para mostrar. Seleccione un rango de fechas.\n  ")]):t._e()],1)},r=[],s=(e("caad"),e("2b0e")),n=e("404a"),i=e("dd61"),c=e("bd4c");i["d"].register(i["a"],i["b"],i["c"],i["f"],i["g"],i["h"],i["e"]);var d=s["a"].extend({name:"VentasPorProducto",data(){return{inicio:null,fin:null,ventas:[],datosProductos:[],chart:null}},mounted(){const t=new Date,a=c["b"].formatDate(t,"YYYY/MM/DD");this.inicio=a,this.fin=a,this.inicio&&this.fin&&this.$nextTick((()=>{this.cargarDatos()}))},beforeUnmount(){this.chart&&this.chart.destroy()},computed:{productosList(){return this.$data.datosProductos}},methods:{async cargarDatos(){if(!this.inicio||!this.fin)return;let t=this.inicio,a=this.fin;"string"===typeof t&&t.includes("/")||t&&(t=c["b"].formatDate(t,"YYYY/MM/DD")),"string"===typeof a&&a.includes("/")||a&&(a=c["b"].formatDate(a,"YYYY/MM/DD")),console.log("Fechas para filtrar:",t,a),this.$q.loading.show();try{await n["a"].getInstance().get(t,a).then((t=>{console.log("Ventas encontradas:",t),this.ventas=t||[],this.agruparPorProducto(),this.actualizarGrafico()}))}catch(e){console.error("Error al cargar datos:",e),this.$q.notify({position:"top",type:"negative",message:`Error al cargar los datos de ventas: ${e.message||e}`})}finally{this.$q.loading.hide()}},agruparPorProducto(){const t={};this.ventas.forEach((a=>{a.productos&&Array.isArray(a.productos)&&a.productos.forEach((a=>{const e=a.producto||"Sin nombre";t[e]||(t[e]={producto:e,cantidadTotal:0,totalVentas:0}),t[e].cantidadTotal+=Number(a.cantidad||0),t[e].totalVentas+=Number(a.valor_bs||0)}))})),this.datosProductos=Object.values(t).sort(((t,a)=>a.totalVentas-t.totalVentas))},actualizarGrafico(){if(!this.$refs.chartCanvas)return;if(this.chart&&this.chart.destroy(),0===this.datosProductos.length)return;const t=this.datosProductos.map((t=>t.producto)),a=this.datosProductos.map((t=>t.totalVentas)),e=this.datosProductos.map((t=>t.cantidadTotal)),o=this.$refs.chartCanvas.getContext("2d");this.chart=new i["d"](o,{type:"bar",data:{labels:t,datasets:[{label:"Total Ventas (Bs)",data:a,backgroundColor:["rgba(54, 162, 235, 0.6)","rgba(255, 99, 132, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)","rgba(199, 199, 199, 0.6)","rgba(83, 102, 255, 0.6)","rgba(255, 99, 255, 0.6)","rgba(99, 255, 132, 0.6)"],borderColor:["rgba(54, 162, 235, 1)","rgba(255, 99, 132, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(199, 199, 199, 1)","rgba(83, 102, 255, 1)","rgba(255, 99, 255, 1)","rgba(99, 255, 132, 1)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,legend:{display:!0,position:"top"},tooltips:{callbacks:{label:function(t,a){const o=t.index,r=e[o],s=new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t.yLabel);return`Total: Bs ${s} | Cantidad: ${r}`}}},scales:{yAxes:[{ticks:{beginAtZero:!0,callback:function(t){return new Intl.NumberFormat("es-VE",{minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}}}]}}})}}}),l=d,u=(e("b1ec"),e("2877")),p=e("9989"),_=e("27f9"),v=e("0016"),m=e("7cbe"),f=e("52ee"),h=e("9c40"),b=e("f09f"),g=e("a370"),y=e("2bb1"),C=e("54e1"),x=e("7f67"),q=e("eebe"),D=e.n(q),w=Object(u["a"])(l,o,r,!1,null,"7d555b73",null);a["default"]=w.exports;D()(w,"components",{QPage:p["a"],QInput:_["a"],QIcon:v["a"],QPopupProxy:m["a"],QDate:f["a"],QBtn:h["a"],QCard:b["a"],QCardSection:g["a"],QMarkupTable:y["a"],QBanner:C["a"]}),D()(w,"directives",{ClosePopup:x["a"]})},dc98:function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));class o{constructor(){this.producto_id=null,this.tipo="",this.cantidad=0,this.fecha=null,this.referencia="",this.create_at=null}}}}]);