(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{4204:function(t,a,e){"use strict";e.d(a,"a",(function(){return s}));var o=e("4dec"),r=e("c056"),i=e("dc98"),n=e("abab");const s=new o["a"]("BODEGUITA");s.version(1).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at",ventas:"++id, total, *productos, create_at, update_at"}),s.version(2).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad"}),s.version(3).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia"}),s.version(4).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo"}),s.version(5).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva"}),s.version(6).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),s.version(7).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),s.version(8).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value"}),s.version(9).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),s.version(10).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),s.version(11).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado, monto_exento, monto_base, monto_iva, tasa_iva, monto_igtf, tasa_dolar, monto_dolar",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),s.open().catch((function(t){console.error("Fallo al abrir la base de datos: "+(t.stack||t))})),s.valores_dolar.mapToClass(r["a"]),s.movimientos.mapToClass(i["a"]),s.clientes.mapToClass(n["a"])},"45e8":function(t,a,e){"use strict";e.d(a,"a",(function(){return r}));var o=e("4204");e("bd4c");class r{static getInstance(){return new r}get(){return o["a"].productos.toArray()}save(t){return o["a"].productos.add(t)}update(t,a){return o["a"].productos.update(t,a)}getOne(t){return o["a"].productos.get({id:t})}delete(t){return o["a"].productos.delete(t)}getNombre(t){return o["a"].productos.get({nombre:t})}}},"4ddb":function(t,a,e){"use strict";e.r(a);var o=function(){var t=this,a=t._self._c;return a("q-page",{staticClass:"bg-grey-3 q-pa-md",attrs:{padding:""}},[a("div",{staticClass:"row q-mb-md q-gutter-sm"},[a("q-btn",{staticClass:"col-12 col-sm",attrs:{color:"primary",icon:"create",label:"Nuevo producto"},on:{click:t.dialogoNuevoValor}}),a("q-btn",{staticClass:"col-12 col-sm-auto",attrs:{color:"positive",icon:"file_download",label:"Exportar CSV",disable:0===t.data.length},on:{click:t.exportarProductosCSV}}),a("q-btn",{staticClass:"col-12 col-sm-auto",attrs:{color:"info",icon:"file_upload",label:"Importar CSV"},on:{click:t.triggerImportCSV}})],1),a("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".csv,text/csv"},on:{change:t.importarProductosCSV}}),a("q-table",{attrs:{title:"Productos",data:t.data,columns:t.columns,filter:t.filter,"no-data-label":"No encontré nada para ti","no-results-label":"El filtro no reveló ningún resultado.","row-key":"nombre",grid:t.$q.screen.lt.md,"card-class":"bg-white rounded-card shadow-1"},scopedSlots:t._u([{key:"top-right",fn:function(){return[a("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Buscar"},model:{value:t.filter,callback:function(a){t.filter=a},expression:"filter"}},[a("q-icon",{attrs:{slot:"append",name:"search"},slot:"append"})],1)]},proxy:!0},{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"nombre",attrs:{props:e}},[t._v("\n          "+t._s(e.row.nombre)+"\n        ")]),a("q-td",{key:"costo",attrs:{props:e}},[t._v("\n          "+t._s(new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.row.costo))+"\n        ")]),a("q-td",{key:"porcentaje_ganancia",attrs:{props:e}},[t._v("\n          "+t._s((e.row.porcentaje_ganancia||0).toFixed(2))+"%\n        ")]),a("q-td",{key:"porcentaje_iva",attrs:{props:e}},[t._v("\n          "+t._s((e.row.porcentaje_iva||0).toFixed(2))+"%\n        ")]),a("q-td",{key:"precio_venta",attrs:{props:e}},[a("div",[a("div",{staticClass:"text-weight-bold"},[t._v("\n              "+t._s(new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t.calcularPrecioVenta(e.row.costo,e.row.porcentaje_ganancia,e.row.porcentaje_iva)))+"\n            ")]),e.row.porcentaje_iva?a("div",{staticClass:"text-caption text-grey-7"},[t._v("\n              Sin IVA: "+t._s(new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t.calcularPrecioSinIva(e.row.costo,e.row.porcentaje_ganancia)))+"\n              | IVA: "+t._s(new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t.calcularIva(t.calcularPrecioSinIva(e.row.costo,e.row.porcentaje_ganancia),e.row.porcentaje_iva)))+"\n            ")]):t._e()])]),a("q-td",{key:"ganancia_unitaria",attrs:{props:e}},[a("span",{staticClass:"text-positive text-weight-bold"},[t._v("\n            "+t._s(new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t.calcularGananciaUnitaria(e.row)))+"\n          ")])]),a("q-td",{key:"cantidad",attrs:{props:e}},[t._v("\n          "+t._s(e.row.cantidad)+"\n        ")]),a("q-td",{key:"create_at",attrs:{props:e}},[t._v("\n          "+t._s(t.hoyFecha(e.row.create_at))+"\n        ")]),a("q-td",{key:"id",attrs:{props:e}},[a("q-btn-group",{attrs:{flat:""}},[a("q-btn",{attrs:{flat:"",round:"",color:"info",icon:"add_circle"},on:{click:function(a){return t.agregarCantidad(e.row)}}}),a("q-btn",{attrs:{flat:"",round:"",color:"warning",icon:"edit"},on:{click:function(a){return t.editarProducto(e.row)}}}),a("q-btn",{attrs:{flat:"",round:"",color:"negative",icon:"delete"},on:{click:function(a){return a.stopPropagation(),t.deleteR(e.row.id)}}})],1)],1)],1)]}},{key:"item",fn:function(e){return[a("div",{staticClass:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},[a("q-card",{staticClass:"rounded-card shadow-1"},[a("q-card-section",{staticClass:"row full-width justify-between items-center"},[a("div",{staticClass:"col-6"},[a("div",{staticClass:"text-h6"},[t._v(t._s(e.row.nombre))])]),a("div",{staticClass:"col-6 text-right"},[a("q-btn-group",{attrs:{flat:""}},[a("q-btn",{attrs:{flat:"",round:"",dense:"",color:"info",icon:"add_circle"},on:{click:function(a){return t.agregarCantidad(e.row)}}}),a("q-btn",{attrs:{flat:"",round:"",dense:"",color:"warning",icon:"edit"},on:{click:function(a){return t.editarProducto(e.row)}}}),a("q-btn",{attrs:{flat:"",round:"",dense:"",color:"negative",icon:"delete"},on:{click:function(a){return a.stopPropagation(),t.deleteR(e.row.id)}}})],1)],1)]),a("q-separator"),a("q-list",{attrs:{dense:""}},[a("q-item",[a("q-item-section",[a("q-item-label",{attrs:{caption:""}},[t._v("Costo")]),a("q-item-label",[t._v(t._s(new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.row.costo)))])],1),a("q-item-section",{attrs:{side:""}},[a("q-item-label",{attrs:{caption:""}},[t._v("Cantidad")]),a("q-item-label",{staticClass:"text-weight-bold"},[t._v(t._s(e.row.cantidad))])],1)],1),a("q-item",[a("q-item-section",{staticClass:"q-pb-xs"},[a("q-item-label",{attrs:{caption:""}},[t._v("Precio Venta")]),a("q-item-label",{staticClass:"text-primary text-weight-bold"},[t._v(t._s(new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t.calcularPrecioVenta(e.row.costo,e.row.porcentaje_ganancia,e.row.porcentaje_iva))))])],1),a("q-item-section",{attrs:{side:""}},[a("q-item-label",{attrs:{caption:""}},[t._v("Ganancia")]),a("q-item-label",{staticClass:"text-positive"},[t._v(t._s(new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t.calcularGananciaUnitaria(e.row))))])],1)],1)],1)],1)],1)]}},{key:"no-data",fn:function({icon:e,message:o,filter:r}){return[a("div",{staticClass:"full-width row flex-center text-accent q-gutter-sm"},[a("q-icon",{attrs:{size:"2em",name:"sentiment_dissatisfied"}}),a("span",[t._v("\n          Bueno, esto es triste... "+t._s(o)+"\n        ")]),a("q-icon",{attrs:{size:"2em",name:r?"filter_b_and_w":e}})],1)]}}])}),a("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:t.m_nuevo_producto,callback:function(a){t.m_nuevo_producto=a},expression:"m_nuevo_producto"}},[a("q-card",[a("q-toolbar",[a("q-avatar",{attrs:{square:""}},[a("img",{attrs:{src:`${t.$router.options.base||""}icons/favicon-128x128.png`}})]),a("q-toolbar-title",[a("span",{staticClass:"text-weight-bold"},[t._v("Nuevo Producto")])]),a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"close"},on:{click:t.cerrar}})],1),a("q-card-section",[a("div",{staticClass:"q-gutter-md"},[a("q-input",{attrs:{label:"Nombre"},model:{value:t.form.nombre,callback:function(a){t.$set(t.form,"nombre",a)},expression:"form.nombre"}}),a("q-toggle",{attrs:{label:"Ingresar valores en Bolívares (Bs)"+(t.valor_dolar?" - Dólar: Bs "+new Intl.NumberFormat("es-VE").format(t.valor_dolar):" - Sin valor del dólar"),color:"primary",disable:!t.valor_dolar},on:{input:t.toggleMoneda},model:{value:t.ingresarEnBs,callback:function(a){t.ingresarEnBs=a},expression:"ingresarEnBs"}}),t.ingresarEnBs?a("q-input",{attrs:{type:"number",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right",label:"Costo (Bs)",hint:"Se convertirá automáticamente a USD"},scopedSlots:t._u([t.form.costo_bs&&t.valor_dolar?{key:"append",fn:function(){return[a("q-chip",{attrs:{dense:"",color:"primary","text-color":"white"}},[t._v("\n                $"+t._s((t.form.costo_bs/t.valor_dolar).toFixed(2))+"\n              ")])]},proxy:!0}:null],null,!0),model:{value:t.form.costo_bs,callback:function(a){t.$set(t.form,"costo_bs",t._n(a))},expression:"form.costo_bs"}}):a("q-input",{attrs:{type:"number",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right",label:"Costo (USD)"},model:{value:t.form.costo,callback:function(a){t.$set(t.form,"costo",t._n(a))},expression:"form.costo"}}),a("q-input",{attrs:{type:"number",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right",label:"Porcentaje de Ganancia (%)"},model:{value:t.form.porcentaje_ganancia,callback:function(a){t.$set(t.form,"porcentaje_ganancia",t._n(a))},expression:"form.porcentaje_ganancia"}}),a("q-input",{attrs:{type:"number",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right",label:"IVA (%)",hint:"Impuesto que se sumará al precio de venta"},model:{value:t.form.porcentaje_iva,callback:function(a){t.$set(t.form,"porcentaje_iva",t._n(a))},expression:"form.porcentaje_iva"}}),a("q-input",{attrs:{type:"number",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right",label:"Cantidad"},model:{value:t.form.cantidad,callback:function(a){t.$set(t.form,"cantidad",t._n(a))},expression:"form.cantidad"}}),a("input",{directives:[{name:"model",rawName:"v-model",value:t.form.create_at,expression:"form.create_at"}],attrs:{type:"hidden"},domProps:{value:t.form.create_at},on:{input:function(a){a.target.composing||t.$set(t.form,"create_at",a.target.value)}}})],1)]),a("q-separator"),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{color:"primary",label:"Guardar"},on:{click:t.save}})],1)],1)],1),a("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:t.m_editar_producto,callback:function(a){t.m_editar_producto=a},expression:"m_editar_producto"}},[a("q-card",[a("q-toolbar",[a("q-avatar",{attrs:{square:""}},[a("img",{attrs:{src:`${t.$router.options.base||""}icons/favicon-128x128.png`}})]),a("q-toolbar-title",[a("span",{staticClass:"text-weight-bold"},[t._v("Editar Producto")])]),a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"close"},on:{click:t.cerrarEditar}})],1),a("q-card-section",[a("div",{staticClass:"q-gutter-md"},[a("q-input",{attrs:{label:"Nombre"},model:{value:t.form_editar.nombre,callback:function(a){t.$set(t.form_editar,"nombre",a)},expression:"form_editar.nombre"}}),a("q-toggle",{attrs:{label:"Ingresar valores en Bolívares (Bs)"+(t.valor_dolar?" - Dólar: Bs "+new Intl.NumberFormat("es-VE").format(t.valor_dolar):" - Sin valor del dólar"),color:"primary",disable:!t.valor_dolar},on:{input:t.toggleMonedaEditar},model:{value:t.ingresarEnBsEditar,callback:function(a){t.ingresarEnBsEditar=a},expression:"ingresarEnBsEditar"}}),t.ingresarEnBsEditar?a("q-input",{attrs:{type:"number",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right",label:"Costo (Bs)",hint:"Se convertirá automáticamente a USD"},scopedSlots:t._u([t.form_editar.costo_bs&&t.valor_dolar?{key:"append",fn:function(){return[a("q-chip",{attrs:{dense:"",color:"primary","text-color":"white"}},[t._v("\n                $"+t._s((t.form_editar.costo_bs/t.valor_dolar).toFixed(2))+"\n              ")])]},proxy:!0}:null],null,!0),model:{value:t.form_editar.costo_bs,callback:function(a){t.$set(t.form_editar,"costo_bs",t._n(a))},expression:"form_editar.costo_bs"}}):a("q-input",{attrs:{type:"number",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right",label:"Costo (USD)"},model:{value:t.form_editar.costo,callback:function(a){t.$set(t.form_editar,"costo",t._n(a))},expression:"form_editar.costo"}}),a("q-input",{attrs:{type:"number",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right",label:"Porcentaje de Ganancia (%)"},model:{value:t.form_editar.porcentaje_ganancia,callback:function(a){t.$set(t.form_editar,"porcentaje_ganancia",t._n(a))},expression:"form_editar.porcentaje_ganancia"}}),a("q-input",{attrs:{type:"number",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right",label:"IVA (%)",hint:"Impuesto que se sumará al precio de venta"},model:{value:t.form_editar.porcentaje_iva,callback:function(a){t.$set(t.form_editar,"porcentaje_iva",t._n(a))},expression:"form_editar.porcentaje_iva"}}),a("q-input",{attrs:{type:"number",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right",label:"Cantidad"},model:{value:t.form_editar.cantidad,callback:function(a){t.$set(t.form_editar,"cantidad",t._n(a))},expression:"form_editar.cantidad"}}),a("input",{directives:[{name:"model",rawName:"v-model",value:t.form_editar.create_at,expression:"form_editar.create_at"}],attrs:{type:"hidden"},domProps:{value:t.form_editar.create_at},on:{input:function(a){a.target.composing||t.$set(t.form_editar,"create_at",a.target.value)}}})],1)]),a("q-separator"),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{color:"primary",label:"Guardar"},on:{click:function(a){return t.actualizarProducto(t.form_editar.id)}}})],1)],1)],1),a("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:t.m_cantidad_producto,callback:function(a){t.m_cantidad_producto=a},expression:"m_cantidad_producto"}},[a("q-card",[a("q-toolbar",[a("q-avatar",{attrs:{square:""}},[a("img",{attrs:{src:`${t.$router.options.base||""}icons/favicon-128x128.png`}})]),a("q-toolbar-title",[a("span",{staticClass:"text-weight-bold"},[t._v(t._s(t.form_cantidad.nombre))])]),a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"close"},on:{click:t.cerrarCantidad}})],1),a("q-card-section",[a("div",{staticClass:"q-gutter-md"},[a("q-input",{attrs:{type:"number",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right",label:"Cantidad Actual",readonly:""},model:{value:t.form_cantidad.cantidad,callback:function(a){t.$set(t.form_cantidad,"cantidad",t._n(a))},expression:"form_cantidad.cantidad"}}),a("q-input",{attrs:{type:"number",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right",label:"Cantidad a agregar"},model:{value:t.cantidad_agregar,callback:function(a){t.cantidad_agregar=t._n(a)},expression:"cantidad_agregar"}}),a("input",{directives:[{name:"model",rawName:"v-model",value:t.form_cantidad.create_at,expression:"form_cantidad.create_at"}],attrs:{type:"hidden"},domProps:{value:t.form_cantidad.create_at},on:{input:function(a){a.target.composing||t.$set(t.form_cantidad,"create_at",a.target.value)}}})],1)]),a("q-separator"),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{color:"primary",label:"Guardar"},on:{click:function(a){return t.actualizarCantidad(t.form_cantidad.id)}}})],1)],1)],1)],1)},r=[],i=(e("5319"),e("ddb0"),e("2b3d"),e("9861"),e("d9e2"),e("caad"),e("bd4c")),n=e("45e8"),s=e("e633");class c{constructor(){this.nombre="",this.costo=0,this.cantidad=0,this.porcentaje_ganancia=0,this.porcentaje_iva=0,this.create_at=null,this.costo_bs=0}}var l=e("9a27"),d=e("dc98"),m={name:"Productos",data(){return{form:new c,form_editar:{},form_cantidad:{},cantidad_agregar:null,m_nuevo_producto:!1,m_editar_producto:!1,m_cantidad_producto:!1,data:[],filter:"",ingresarEnBs:!1,ingresarEnBsEditar:!1,valor_dolar:null,columns:[{name:"nombre",required:!0,label:"Nombre",align:"center",field:t=>t.nombre,sortable:!0},{name:"costo",required:!0,label:"Costo",align:"center",field:t=>t.costo,format:t=>`${new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}`,sortable:!0},{name:"porcentaje_ganancia",required:!0,label:"Ganancia %",align:"center",field:t=>t.porcentaje_ganancia||0,format:t=>`${parseFloat(t).toFixed(2)}%`,sortable:!0},{name:"porcentaje_iva",required:!0,label:"IVA %",align:"center",field:t=>t.porcentaje_iva||0,format:t=>`${parseFloat(t).toFixed(2)}%`,sortable:!0},{name:"precio_venta",required:!0,label:"Precio de Venta",align:"center",field:t=>{const a=t.porcentaje_ganancia||0,e=t.porcentaje_iva||0;if(!t.costo)return 0;const o=t.costo+t.costo*a/100,r=o*(e/100);return o+r},format:t=>`${new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}`,sortable:!0},{name:"ganancia_unitaria",required:!0,label:"Ganancia/Unidad",align:"center",field:t=>{const a=t.porcentaje_ganancia||0;return t.costo?t.costo*(a/100):0},format:t=>`${new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}`,sortable:!0},{name:"cantidad",required:!0,label:"Cantidad",align:"center",field:t=>t.cantidad,format:t=>`${new Intl.NumberFormat("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}`,sortable:!0},{name:"create_at",align:"center",label:"Fecha",field:"create_at",sortable:!0,format:t=>`${this.hoyFecha(t)}`},{name:"id",align:"left",label:"Acciones",field:"id",sortable:!1}]}},mounted(){this.get().then((()=>{this.migrarValorACosto()})),this.getDolar()},computed:{hoyDate(){let t=Date.now();return i["b"].formatDate(t,"dddd D MMMM hh:mm A")},fechaCreacion(){let t=Date.now();return i["b"].formatDate(t,"YYYY/MM/DD HH:mm:ss")}},methods:{hoyFecha(t){return i["b"].formatDate(t,"DD-MM-YYYY HH:mm:ss")},calcularPrecioVenta(t,a,e){if(!t)return 0;const o=a||0,r=e||0,i=t+t*o/100,n=i*(r/100);return parseFloat((i+n).toFixed(2))},calcularPrecioSinIva(t,a){if(!t)return 0;const e=a||0;return parseFloat((t+t*e/100).toFixed(2))},calcularIva(t,a){if(!t)return 0;const e=a||0;return parseFloat((t*(e/100)).toFixed(2))},calcularGananciaUnitaria(t){const a=t.costo||0,e=t.porcentaje_ganancia||0;return parseFloat((a*e/100).toFixed(2))},dialogoNuevoValor(){this.m_nuevo_producto=!0},cerrar(){this.form=new c,this.$set(this.form,"costo_bs",null),this.ingresarEnBs=!1,this.m_nuevo_producto=!1},cerrarEditar(){this.form_editar={},this.ingresarEnBsEditar=!1,this.m_editar_producto=!1},getDolar(){s["a"].getInstance().getUltimo().then((t=>{t&&t.valor_dolar?this.valor_dolar=t.valor_dolar:(this.valor_dolar=null,this.$q.notify({position:"top",type:"warning",message:'No hay valor del dólar configurado. Configúralo en la sección "Valor Dolar" para usar conversión de moneda.',timeout:5e3}))})).catch((t=>{console.error("Error al obtener valor del dólar:",t),this.valor_dolar=null}))},toggleMoneda(){this.ingresarEnBs?this.valor_dolar&&this.form.costo&&(this.form.costo_bs=parseFloat((this.form.costo*this.valor_dolar).toFixed(2))):this.form.costo_bs=null},toggleMonedaEditar(){this.ingresarEnBsEditar?this.valor_dolar&&this.form_editar.costo&&(this.form_editar.costo_bs=parseFloat((this.form_editar.costo*this.valor_dolar).toFixed(2))):this.form_editar.costo_bs=null},cerrarCantidad(){this.form_cantidad={},this.m_cantidad_producto=!1,this.cantidad_agregar=null},async get(){this.$q.loading.show(),await n["a"].getInstance().get().then((t=>{this.data=t})),this.$q.loading.hide()},exportarProductosCSV(){if(0===this.data.length)return void this.$q.notify({position:"top",type:"warning",message:"No hay productos para exportar"});const t=["Nombre","Costo (USD)","Cantidad","Ganancia (%)","IVA (%)"];let a=t.join(",")+"\n";this.data.forEach((t=>{const e=[`"${(t.nombre||"").replace(/"/g,'""')}"`,t.costo||0,t.cantidad||0,t.porcentaje_ganancia||0,t.porcentaje_iva||0];a+=e.join(",")+"\n"}));const e=new Blob(["\ufeff"+a],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),r=URL.createObjectURL(e);o.setAttribute("href",r),o.setAttribute("download",`productos_${i["b"].formatDate(Date.now(),"YYYY-MM-DD_HH-mm-ss")}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout((()=>URL.revokeObjectURL(r)),100),this.$q.notify({position:"top",type:"positive",message:`Se exportaron ${this.data.length} producto(s) correctamente`})},triggerImportCSV(){this.$refs.fileInput.click()},async importarProductosCSV(t){const a=t.target.files[0];if(a){if(!a.name.toLowerCase().endsWith(".csv"))return this.$q.notify({position:"top",type:"negative",message:"El archivo debe ser un CSV (.csv)"}),void(t.target.value="");this.$q.loading.show({message:"Importando productos..."});try{const o=await this.readFileAsText(a),r=this.parseCSV(o);if(0===r.length)return this.$q.loading.hide(),this.$q.notify({position:"top",type:"warning",message:"El archivo CSV está vacío o no tiene el formato correcto"}),void(t.target.value="");let i=0,s=0;const c=[];for(const t of r)try{if(!t.nombre||""===t.nombre.trim()){s++,c.push(`Producto sin nombre en línea ${t._linea||"desconocida"}`);continue}const a={nombre:t.nombre.trim().toUpperCase(),costo:parseFloat(t.costo||0),cantidad:parseFloat(t.cantidad||0),porcentaje_ganancia:parseFloat(t.porcentaje_ganancia||0),porcentaje_iva:parseFloat(t.porcentaje_iva||0),create_at:Date.now()},e=await n["a"].getInstance().getNombre(a.nombre);e?await n["a"].getInstance().update(e.id,a):await n["a"].getInstance().save(a),i++}catch(e){s++,c.push(`Error en "${t.nombre||"sin nombre"}": ${e.message}`),console.error("Error al importar producto:",e)}this.$q.loading.hide(),await this.get(),0===s?this.$q.notify({position:"top",type:"positive",message:`Se importaron ${i} producto(s) correctamente`,timeout:3e3}):this.$q.notify({position:"top",type:"warning",message:`Se importaron ${i} producto(s). ${s} error(es).`,timeout:5e3,actions:[{label:"Ver detalles",handler:()=>{this.$q.dialog({title:"Errores de importación",message:c.join("\n"),html:!0})}}]})}catch(e){this.$q.loading.hide(),this.$q.notify({position:"top",type:"negative",message:`Error al leer el archivo: ${e.message}`}),console.error("Error al importar CSV:",e)}t.target.value=""}},readFileAsText(t){return new Promise(((a,e)=>{const o=new FileReader;o.onload=t=>a(t.target.result),o.onerror=t=>e(new Error("Error al leer el archivo")),o.readAsText(t,"UTF-8")}))},parseCSV(t){const a=t.split(/\r?\n/).filter((t=>""!==t.trim()));if(a.length<2)return[];a[0].toLowerCase();const e=this.parseCSVLine(a[0]),o={nombre:-1,costo:-1,cantidad:-1,porcentaje_ganancia:-1,porcentaje_iva:-1};if(e.forEach(((t,a)=>{const e=t.toLowerCase().trim().replace(/"/g,"");e.includes("nombre")?o.nombre=a:e.includes("costo")?o.costo=a:e.includes("cantidad")?o.cantidad=a:e.includes("ganancia")?o.porcentaje_ganancia=a:e.includes("iva")&&(o.porcentaje_iva=a)})),-1===o.nombre)throw new Error('No se encontró la columna "Nombre" en el CSV');const r=[];for(let i=1;i<a.length;i++){const t=this.parseCSVLine(a[i]);if(0===t.length)continue;const e={_linea:i+1,nombre:o.nombre>=0?(t[o.nombre]||"").replace(/^"|"$/g,""):"",costo:o.costo>=0?parseFloat(t[o.costo]||0):0,cantidad:o.cantidad>=0?parseFloat(t[o.cantidad]||0):0,porcentaje_ganancia:o.porcentaje_ganancia>=0?parseFloat(t[o.porcentaje_ganancia]||0):0,porcentaje_iva:o.porcentaje_iva>=0?parseFloat(t[o.porcentaje_iva]||0):0};r.push(e)}return r},parseCSVLine(t){const a=[];let e="",o=!1;for(let r=0;r<t.length;r++){const i=t[r],n=t[r+1];'"'===i?o&&'"'===n?(e+='"',r++):o=!o:","!==i||o?e+=i:(a.push(e.trim()),e="")}return a.push(e.trim()),a},async migrarValorACosto(){let t=0;for(const a of this.data)(!a.costo||0===a.costo)&&a.valor&&a.valor>0&&(a.costo=a.valor,await n["a"].getInstance().update(a.id,{costo:a.costo}),t++);t>0&&(console.log(`Se migraron ${t} productos de valor a costo`),this.$q.notify({position:"top",type:"positive",message:`Se actualizaron ${t} productos a la nueva estructura de costos.`}))},save(){if(this.ingresarEnBs&&!this.valor_dolar)return this.$q.notify({position:"top",type:"negative",message:'No hay valor del dólar configurado. Por favor, configura un valor del dólar en la sección "Valor Dolar" primero.'}),void this.getDolar();if(""===this.form.nombre.trim())return void this.$q.notify({position:"top",type:"negative",message:"Debe ingresar el nombre del producto"});this.$q.loading.show(),this.form.create_at=this.fechaCreacion,this.ingresarEnBs&&this.valor_dolar?this.form.costo_bs?this.form.costo=parseFloat((parseFloat(this.form.costo_bs)/parseFloat(this.valor_dolar)).toFixed(6)):this.form.costo=0:this.form.costo=parseFloat(parseFloat(this.form.costo||0).toFixed(2)),this.form.porcentaje_ganancia=parseFloat(parseFloat(this.form.porcentaje_ganancia||0).toFixed(2)),this.form.porcentaje_iva=parseFloat(parseFloat(this.form.porcentaje_iva||0).toFixed(2)),this.form.cantidad=parseFloat(parseFloat(this.form.cantidad).toFixed(2)),this.form.nombre=this.form.nombre.toUpperCase();const t={...this.form};delete t.valor_bs,delete t.costo_bs,n["a"].getInstance().save(t).then((async a=>{try{const e=new d["a"];e.producto_id=a,e.tipo="ENTRADA",e.cantidad=t.cantidad,e.fecha=Date.now(),e.referencia="Inventario Inicial",e.create_at=this.fechaCreacion,await l["a"].getInstance().save(e)}catch(e){console.error("Error al registrar movimiento inicial:",e)}this.m_nuevo_producto=!1,this.form=new c,this.get(),this.$q.loading.hide(),this.$q.notify({position:"top",type:"positive",message:"Datos guardados."})})).catch((function(t){console.error(`Error: ${t.stack}`),this.$q.notify({position:"top",type:"negative",message:`Error: ${t.stack}`})}))},editarProducto(t){this.form_editar={...t},void 0!==this.form_editar.porcentaje_iva&&null!==this.form_editar.porcentaje_iva||this.$set(this.form_editar,"porcentaje_iva",0),this.$set(this.form_editar,"valor_bs",null),this.$set(this.form_editar,"costo_bs",null),this.ingresarEnBsEditar=!1,this.m_editar_producto=!0},async actualizarProducto(t){if(this.ingresarEnBsEditar&&!this.valor_dolar)return this.$q.notify({position:"top",type:"negative",message:'No hay valor del dólar configurado. Por favor, configura un valor del dólar en la sección "Valor Dolar" primero.'}),void this.getDolar();this.$q.loading.show(),this.form_editar.create_at=this.fechaCreacion,this.ingresarEnBsEditar&&this.valor_dolar?this.form_editar.costo_bs?this.form_editar.costo=parseFloat((parseFloat(this.form_editar.costo_bs)/parseFloat(this.valor_dolar)).toFixed(6)):this.form_editar.costo=0:this.form_editar.costo=parseFloat(parseFloat(this.form_editar.costo||0).toFixed(2)),this.form_editar.porcentaje_ganancia=parseFloat(parseFloat(this.form_editar.porcentaje_ganancia||0).toFixed(2)),this.form_editar.porcentaje_iva=parseFloat(parseFloat(this.form_editar.porcentaje_iva||0).toFixed(2)),this.form_editar.cantidad=parseFloat(parseFloat(this.form_editar.cantidad).toFixed(2)),this.form_editar.nombre=this.form_editar.nombre.toUpperCase();const a={...this.form_editar};delete a.valor_bs,delete a.costo_bs;let e=0;try{const o=await n["a"].getInstance().getOne(t);o&&(e=a.cantidad-o.cantidad)}catch(o){console.error("Error al obtener producto anterior:",o)}await n["a"].getInstance().update(t,a).then((async()=>{if(0!==e)try{const a=new d["a"];a.producto_id=t,a.tipo="AJUSTE",a.cantidad=e,a.fecha=Date.now(),a.referencia="Edición de Producto",a.create_at=this.fechaCreacion,await l["a"].getInstance().save(a)}catch(o){console.error("Error al registrar ajuste:",o)}this.form_editar={},this.m_editar_producto=!1,this.get(),this.$q.loading.hide(),this.$q.notify({position:"top",type:"positive",message:"Datos actualizados."})})).catch((function(t){console.error(`Error: ${t.stack}`),this.$q.notify({position:"top",type:"negative",message:`Error: ${t.stack}`})}))},agregarCantidad(t){this.m_cantidad_producto=!0,this.form_cantidad=t},async actualizarCantidad(t){null!==this.cantidad_agregar&&void 0!==this.cantidad_agregar&&""!==this.cantidad_agregar?parseFloat(this.cantidad_agregar)<=0?this.$q.notify({position:"top",type:"negative",message:"La cantidad debe ser mayor a 0"}):(this.$q.loading.show(),this.form_cantidad.create_at=this.fechaCreacion,this.form_cantidad.cantidad=parseFloat((parseFloat(this.form_cantidad.cantidad)+parseFloat(this.cantidad_agregar)).toFixed(2)),await n["a"].getInstance().update(t,this.form_cantidad).then((async()=>{try{const a=new d["a"];a.producto_id=t,a.tipo="ENTRADA",a.cantidad=parseFloat(this.cantidad_agregar),a.fecha=Date.now(),a.referencia="Agregado Manualmente",a.create_at=this.fechaCreacion,await l["a"].getInstance().save(a)}catch(a){console.error("Error al registrar entrada manual:",a)}this.form_cantidad={},this.cantidad_agregar=null,this.m_cantidad_producto=!1,this.get(),this.$q.loading.hide(),this.$q.notify({position:"top",type:"positive",message:"Cantidad agregada."})})).catch((function(t){console.error(`Error: ${t.stack}`),this.$q.notify({position:"top",type:"negative",message:`Error: ${t.stack}`})}))):this.$q.notify({position:"top",type:"negative",message:"Debe ingresar la cantidad"})},deleteR(t){t?this.$q.dialog({title:"¿Desea borrar este registro?",message:'<strong class="text-red">¡Los cambios no podrán deshacerse!</strong>',html:!0,cancel:!0,persistent:!0}).onOk((()=>{this.$q.loading.show(),n["a"].getInstance().delete(t).then((()=>{this.get(),this.$q.loading.hide(),this.$q.notify({position:"top",type:"positive",message:"¡Datos eliminados!"})}))})).onCancel((()=>{})):this.$q.notify({position:"top",type:"warning",message:"¡Selecione un registro!"})}}},u=m,p=e("2877"),_=e("9989"),f=e("9c40"),g=e("eaac"),h=e("27f9"),v=e("0016"),b=e("bd08"),q=e("db86"),y=e("e7a9"),w=e("f09f"),F=e("a370"),x=e("eb85"),k=e("1c1c"),$=e("66e5"),C=e("4074"),j=e("0170"),E=e("24e8"),D=e("65c6"),I=e("cb32"),V=e("6ac5"),S=e("9564"),P=e("b047"),B=e("4b7e"),N=e("eebe"),A=e.n(N),Q=Object(p["a"])(u,o,r,!1,null,null,null);a["default"]=Q.exports;A()(Q,"components",{QPage:_["a"],QBtn:f["a"],QTable:g["a"],QInput:h["a"],QIcon:v["a"],QTr:b["a"],QTd:q["a"],QBtnGroup:y["a"],QCard:w["a"],QCardSection:F["a"],QSeparator:x["a"],QList:k["a"],QItem:$["a"],QItemSection:C["a"],QItemLabel:j["a"],QDialog:E["a"],QToolbar:D["a"],QAvatar:I["a"],QToolbarTitle:V["a"],QToggle:S["a"],QChip:P["a"],QCardActions:B["a"]})},"9a27":function(t,a,e){"use strict";e.d(a,"a",(function(){return r}));var o=e("4204");class r{static getInstance(){return new r}save(t){return o["a"].movimientos.add(t)}getAll(){return o["a"].movimientos.toArray()}getByProducto(t){return o["a"].movimientos.where("producto_id").equals(t).toArray()}getSalidasPorFecha(t,a){return o["a"].movimientos.where("fecha").between(t,a,!0,!0).filter((t=>"SALIDA"===t.tipo)).toArray()}getHistorialProducto(t){return o["a"].movimientos.where("producto_id").equals(t).sortBy("fecha")}}},abab:function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));class o{constructor(){this.cedula="",this.nombre="",this.telefono="",this.create_at=null,this.update_at=null}}},c056:function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));class o{constructor(){this.valor_dolar=null,this.create_at=null}}},dc98:function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));class o{constructor(){this.producto_id=null,this.tipo="",this.cantidad=0,this.fecha=null,this.referencia="",this.create_at=null}}},e633:function(t,a,e){"use strict";e.d(a,"a",(function(){return r}));var o=e("4204");e("bd4c");class r{static getInstance(){return new r}get(){return o["a"].valores_dolar.toArray()}save(t){return o["a"].valores_dolar.add(t)}getOne(t){return o["a"].valores_dolar.get({id:t})}delete(t){return o["a"].valores_dolar.delete(t)}getUltimo(){return o["a"].valores_dolar.orderBy("create_at").reverse().limit(1).first()}}}}]);