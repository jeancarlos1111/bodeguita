(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{4204:function(t,a,e){"use strict";e.d(a,"a",(function(){return c}));var o=e("4dec"),r=e("c056"),s=e("dc98"),i=e("abab");const c=new o["a"]("BODEGUITA");c.version(1).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at",ventas:"++id, total, *productos, create_at, update_at"}),c.version(2).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad"}),c.version(3).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia"}),c.version(4).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo"}),c.version(5).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva"}),c.version(6).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),c.version(7).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]"}),c.version(8).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value"}),c.version(9).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),c.version(10).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),c.version(11).stores({valores_dolar:"++id, valor, create_at, update_at",productos:"++id, &nombre, valor, create_at, update_at, cantidad, porcentaje_ganancia, costo, porcentaje_iva",ventas:"++id, total, *productos, create_at, update_at, metodo_pago, numero_factura, cliente_id, estado, monto_pagado, monto_exento, monto_base, monto_iva, tasa_iva, monto_igtf, tasa_dolar, monto_dolar",movimientos:"++id, producto_id, tipo, cantidad, fecha, referencia, [producto_id+fecha]",configuracion:"&key, value",clientes:"++id, &cedula, nombre, telefono, create_at, update_at"}),c.open().catch((function(t){console.error("Fallo al abrir la base de datos: "+(t.stack||t))})),c.valores_dolar.mapToClass(r["a"]),c.movimientos.mapToClass(s["a"]),c.clientes.mapToClass(i["a"])},"45e8":function(t,a,e){"use strict";e.d(a,"a",(function(){return r}));var o=e("4204");e("bd4c");class r{static getInstance(){return new r}get(){return o["a"].productos.toArray()}save(t){return o["a"].productos.add(t)}update(t,a){return o["a"].productos.update(t,a)}getOne(t){return o["a"].productos.get({id:t})}delete(t){return o["a"].productos.delete(t)}getNombre(t){return o["a"].productos.get({nombre:t})}}},"79be":function(t,a,e){"use strict";e.r(a);var o=function(){var t=this,a=t._self._c;return a("q-page",{staticClass:"q-pa-md bg-grey-2"},[a("div",{staticClass:"text-h5 q-mb-md text-primary text-weight-bold"},[a("q-icon",{staticClass:"q-mr-sm",attrs:{name:"psychology",size:"md"}}),t._v("Kardex Inteligente\n    ")],1),a("div",{staticClass:"row q-col-gutter-md q-mb-xl"},[a("div",{staticClass:"col-12"},[t.estadisticas.productosBajoStock>0?a("q-banner",{staticClass:"bg-indigo-1 text-primary shadow-1",attrs:{rounded:""},scopedSlots:t._u([{key:"avatar",fn:function(){return[a("q-icon",{attrs:{name:"add_alert",color:"primary"}})]},proxy:!0}],null,!1,1317674578)},[a("div",{staticClass:"text-weight-bold row items-center"},[t._v("\n                    Tienes "+t._s(t.estadisticas.productosBajoStock)+" productos sugeridos para reabastecimiento.\n                    "),t.estadisticas.productosCriticos>0?a("q-chip",{staticClass:"q-ml-sm",attrs:{color:"negative","text-color":"white",size:"sm"}},[t._v("\n                        "+t._s(t.estadisticas.productosCriticos)+" Críticos\n                    ")]):t._e()],1)]):a("q-banner",{staticClass:"bg-positive text-white shadow-1",attrs:{rounded:""},scopedSlots:t._u([{key:"avatar",fn:function(){return[a("q-icon",{attrs:{name:"check_circle",color:"white"}})]},proxy:!0}])},[a("div",{staticClass:"text-weight-bold"},[t._v("\n                    ¡Tu inventario parece saludable! No hay alertas urgentes.\n                ")])])],1),t._l(t.estadisticas.topSugerencias,(function(e,o){return a("div",{key:o,staticClass:"col-12 col-md-4"},[a("q-card",{staticClass:"my-card shadow-2",class:"ALTA"===e.prioridad?"bg-red-1":"bg-white"},[a("q-card-section",[a("div",{staticClass:"row items-center no-wrap"},[a("div",{staticClass:"col"},[a("div",{staticClass:"text-h6"},[t._v(t._s(e.producto.nombre))]),a("div",{staticClass:"text-subtitle2 text-grey-7"},[t._v("Stock: "+t._s(e.producto.cantidad))])]),a("div",{staticClass:"col-auto"},[a("q-btn",{attrs:{round:"",color:"primary",icon:"add_shopping_cart",flat:"",dense:"",tooltip:"Agregar Existencia"},on:{click:function(a){return t.openStockDialog(e.producto)}}})],1)])]),a("q-card-section",{staticClass:"q-pt-none"},[a("div",{staticClass:"text-caption text-weight-bold text-uppercase",class:"ALTA"===e.prioridad?"text-negative":"text-orange"},[t._v("\n                        "+t._s(e.mensaje)+"\n                    ")]),a("div",{staticClass:"text-caption"},[t._v("\n                        Ventas/Día (aprox): "+t._s(e.velocidadDia)+"\n                    ")])])],1)],1)}))],2),a("q-separator",{staticClass:"q-mb-md"}),a("div",{staticClass:"text-h6 q-mb-sm text-grey-8"},[t._v("Movimientos Recientes")]),a("q-table",{staticClass:"bg-white rounded-card shadow-1",attrs:{data:t.movimientos,columns:t.columns,"row-key":"id",filter:t.filter,pagination:t.pagination,"no-data-label":"No hay movimientos registrados aún"},on:{"update:pagination":function(a){t.pagination=a}},scopedSlots:t._u([{key:"top-right",fn:function(){return[a("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Buscar"},model:{value:t.filter,callback:function(a){t.filter=a},expression:"filter"}},[a("q-icon",{attrs:{slot:"append",name:"search"},slot:"append"})],1)]},proxy:!0},{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"fecha",attrs:{props:e}},[t._v("\n                    "+t._s(t.formatFecha(e.row.fecha))+"\n                ")]),a("q-td",{key:"producto",attrs:{props:e}},[t._v("\n                    "+t._s(t.getNombreProducto(e.row.producto_id))+"\n                ")]),a("q-td",{key:"tipo",attrs:{props:e}},[a("q-chip",{attrs:{dense:"",color:t.getColorTipo(e.row.tipo),"text-color":"white"}},[t._v("\n                        "+t._s(e.row.tipo)+"\n                    ")])],1),a("q-td",{key:"cantidad",staticClass:"text-weight-bold",attrs:{props:e}},[t._v("\n                    "+t._s("SALIDA"===e.row.tipo?"-":"+")+t._s(e.row.cantidad)+"\n                ")]),a("q-td",{key:"referencia",staticClass:"text-grey-7",attrs:{props:e}},[t._v("\n                    "+t._s(e.row.referencia)+"\n                ")])],1)]}}])}),a("q-dialog",{model:{value:t.showDialogStock,callback:function(a){t.showDialogStock=a},expression:"showDialogStock"}},[a("q-card",{staticStyle:{"min-width":"350px"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("Agregar Existencia")]),t.selectedProduct?a("div",{staticClass:"text-subtitle2"},[t._v("\n                    "+t._s(t.selectedProduct.nombre)+" (Actual: "+t._s(t.selectedProduct.cantidad)+")\n                ")]):t._e()]),a("q-card-section",{staticClass:"q-pt-none"},[a("q-input",{attrs:{dense:"",type:"number",autofocus:"",label:"Cantidad a agregar",rules:[t=>t>0||"Debe ser mayor a 0"]},on:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.saveStock.apply(null,arguments)}},model:{value:t.stockForm.cantidad,callback:function(a){t.$set(t.stockForm,"cantidad",t._n(a))},expression:"stockForm.cantidad"}})],1),a("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancelar"}}),a("q-btn",{attrs:{flat:"",label:"Guardar"},on:{click:t.saveStock}})],1)],1)],1)],1)},r=[],s=e("bd4c"),i=e("9a27"),c=e("45e8");e("ddb0");class n{static getInstance(){return new n}async calcularVelocidadVentas(t){const a=new Date,e=s["b"].subtractFromDate(a,{days:30}),o=e.getTime(),r=a.getTime(),c=await i["a"].getInstance().getByProducto(t),n=c.filter((t=>"SALIDA"===t.tipo&&t.fecha>=o&&t.fecha<=r));if(0===n.length)return 0;const d=n.reduce(((t,a)=>t+a.cantidad),0);return d/30}async generarSugerencias(){const t=await c["a"].getInstance().get(),a=[];for(const e of t){const t=await this.calcularVelocidadVentas(e.id);if(0===t){e.cantidad<=3&&a.push({producto:e,velocidadDia:"---",diasRestantes:0,mensaje:0===e.cantidad?"¡Agotado!":"Stock Crítico (Sin ventas previas)",prioridad:"ALTA"});continue}const o=e.cantidad/t;o<7&&a.push({producto:e,velocidadDia:t.toFixed(2),diasRestantes:Math.floor(o),mensaje:o<1?"¡Agotado o por agotarse hoy!":`Quedan para ${Math.floor(o)} días`,prioridad:o<3?"ALTA":"MEDIA"})}return a.sort(((t,a)=>t.diasRestantes-a.diasRestantes))}async getEstadisticasGenerales(){const t=await this.generarSugerencias(),a=t.length,e=t.filter((t=>t.diasRestantes<3)).length;return{productosBajoStock:a,productosCriticos:e,topSugerencias:t.slice(0,5)}}}var d=e("dc98"),l={name:"PageKardex",data(){return{movimientos:[],productosMap:{},filter:"",estadisticas:{productosBajoStock:0,productosCriticos:0,topSugerencias:[]},showDialogStock:!1,selectedProduct:null,stockForm:{cantidad:""},columns:[{name:"fecha",label:"Fecha",align:"left",field:"fecha",sortable:!0},{name:"producto",label:"Producto",align:"left",field:"producto_id",sortable:!0},{name:"tipo",label:"Tipo",align:"center",field:"tipo",sortable:!0},{name:"cantidad",label:"Cantidad",align:"right",field:"cantidad",sortable:!0},{name:"referencia",label:"Referencia",align:"left",field:"referencia"}],pagination:{sortBy:"fecha",descending:!0,rowsPerPage:10}}},async mounted(){await this.loadProductos(),await this.loadMovimientos(),await this.loadAnalisis()},methods:{formatFecha(t){return s["b"].formatDate(t,"YYYY-MM-DD HH:mm")},async loadProductos(){const t=await c["a"].getInstance().get();t.forEach((t=>{this.$set(this.productosMap,t.id,t.nombre)}))},getNombreProducto(t){return this.productosMap[t]||"Producto Desconocido"},async loadMovimientos(){this.movimientos=await i["a"].getInstance().getAll()},async loadAnalisis(){this.estadisticas=await n.getInstance().getEstadisticasGenerales()},getColorTipo(t){return"ENTRADA"===t?"positive":"SALIDA"===t?"negative":"warning"},openStockDialog(t){this.selectedProduct=t,this.stockForm.cantidad="",this.showDialogStock=!0},async saveStock(){if(!this.stockForm.cantidad||this.stockForm.cantidad<=0)this.$q.notify({type:"warning",message:"Ingrese una cantidad válida"});else try{const t=Number(this.selectedProduct.cantidad)+Number(this.stockForm.cantidad);await c["a"].getInstance().update(this.selectedProduct.id,{cantidad:t});const a=new d["a"];a.producto_id=this.selectedProduct.id,a.tipo="ENTRADA",a.cantidad=Number(this.stockForm.cantidad),a.fecha=Date.now(),a.referencia="Reabastecimiento desde Kardex",a.create_at=new Date,await i["a"].getInstance().save(a),this.$q.notify({type:"positive",message:"Existencia agregada correctamente"}),this.showDialogStock=!1,await this.loadProductos(),await this.loadMovimientos(),await this.loadAnalisis()}catch(t){console.error(t),this.$q.notify({type:"negative",message:"Error al actualizar inventario"})}}}},u=l,p=e("2877"),_=e("9989"),m=e("0016"),v=e("54e1"),g=e("b047"),h=e("f09f"),f=e("a370"),b=e("9c40"),w=e("eb85"),y=e("eaac"),k=e("27f9"),C=e("bd08"),q=e("db86"),x=e("24e8"),A=e("4b7e"),S=e("7f67"),D=e("eebe"),j=e.n(D),P=Object(p["a"])(u,o,r,!1,null,null,null);a["default"]=P.exports;j()(P,"components",{QPage:_["a"],QIcon:m["a"],QBanner:v["a"],QChip:g["a"],QCard:h["a"],QCardSection:f["a"],QBtn:b["a"],QSeparator:w["a"],QTable:y["a"],QInput:k["a"],QTr:C["a"],QTd:q["a"],QDialog:x["a"],QCardActions:A["a"]}),j()(P,"directives",{ClosePopup:S["a"]})},"9a27":function(t,a,e){"use strict";e.d(a,"a",(function(){return r}));var o=e("4204");class r{static getInstance(){return new r}save(t){return o["a"].movimientos.add(t)}getAll(){return o["a"].movimientos.toArray()}getByProducto(t){return o["a"].movimientos.where("producto_id").equals(t).toArray()}getSalidasPorFecha(t,a){return o["a"].movimientos.where("fecha").between(t,a,!0,!0).filter((t=>"SALIDA"===t.tipo)).toArray()}getHistorialProducto(t){return o["a"].movimientos.where("producto_id").equals(t).sortBy("fecha")}}},abab:function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));class o{constructor(){this.cedula="",this.nombre="",this.telefono="",this.create_at=null,this.update_at=null}}},c056:function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));class o{constructor(){this.valor_dolar=null,this.create_at=null}}},dc98:function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));class o{constructor(){this.producto_id=null,this.tipo="",this.cantidad=0,this.fecha=null,this.referencia="",this.create_at=null}}}}]);